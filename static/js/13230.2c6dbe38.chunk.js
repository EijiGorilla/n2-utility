"use strict";(self.webpackChunkn2_utility=self.webpackChunkn2_utility||[]).push([[13230,98156],{13230:(t,e,n)=>{n.r(e),n.d(e,{default:()=>m});var i=n(35143),r=(n(76460),n(81806),n(47249),n(50076),n(85842)),s=n(10183),l=n(47777),a=n(58423),o=n(55754);let u=class extends((0,l.A)(s.A)){constructor(){super(...arguments),this.type="map-image-3d"}initialize(){this._updatingHandles.add((()=>this.exportImageVersion),(()=>this._updatingHandles.addPromise(this.refreshDebounced()))),this._popupHighlightHelper=new a.Uh({createFetchPopupFeaturesQueryGeometry:(t,e)=>(0,o.V)(t,e,this.view),layerView:this,updatingHandles:this._updatingHandles})}destroy(){this._popupHighlightHelper?.destroy()}fetchPopupFeaturesAtLocation(t,e){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,e)}getFetchOptions(){return{timeExtent:this.timeExtent}}};u=(0,i._)([(0,r.$)("esri.views.3d.layers.MapImageLayerView3D")],u);const m=u},43543:(t,e,n)=>{n.d(e,{F:()=>r});var i=n(98156);function r(t,e,n){if(null==t?.timeInfo)return null;const{datesInUnknownTimezone:r=!1,timeOffset:s,useViewTime:l}=t;let a=t.timeExtent;r&&(a=(0,i.toLocalTimeExtent)(a));let o=l?e&&a?e.intersection(a):e||a:a;return!o||o.isEmpty||o.isAllTime?o:(s&&(o=o.offset(-s.value,s.unit)),r&&(o=(0,i.toUTCTimeExtent)(o)),o.equals(n)?n:o)}},47777:(t,e,n)=>{n.d(e,{A:()=>o});var i=n(35143),r=n(46053),s=(n(81806),n(76460),n(47249),n(85842)),l=n(1420),a=n(43543);const o=t=>{let e=class extends t{initialize(){this.exportImageParameters=new l.g({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}get timeExtent(){return(0,a.F)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return(0,i._)([(0,r.MZ)()],e.prototype,"exportImageParameters",void 0),(0,i._)([(0,r.MZ)({readOnly:!0})],e.prototype,"floors",null),(0,i._)([(0,r.MZ)({readOnly:!0})],e.prototype,"exportImageVersion",null),(0,i._)([(0,r.MZ)()],e.prototype,"layer",void 0),(0,i._)([(0,r.MZ)()],e.prototype,"suspended",void 0),(0,i._)([(0,r.MZ)({readOnly:!0})],e.prototype,"timeExtent",null),e=(0,i._)([(0,s.$)("esri.views.layers.MapImageLayerView")],e),e}},98156:(t,e,n)=>{n.r(e),n.d(e,{getTimeExtentFromLayers:()=>f,getTimeSliderSettingsFromWebDocument:()=>d,toLocalTimeExtent:()=>g,toUTCTimeExtent:()=>h});var i=n(18690),r=n(53084),s=n(18288),l=n(59187),a=n(42052),o=n(72027);function u(t){return void 0!==t.timeInfo}async function m(t,e){return t.widgets?.timeSlider?.fullTimeExtent??f(t.allLayers,e)}function c(t){const{numStops:e,stopInterval:n,stops:i}=t;return i?{dates:(0,r.clone)(i)}:n?{interval:n.clone()}:{count:e??5}}async function f(t,e){if(0===t.length)return l.default.allTime;await Promise.all(t.map((t=>t.load({signal:e}))));const n=t.filter(u),r=t.filter((t=>!u(t)&&null!=t.visibilityTimeExtent));if(0===n.length&&0===r.length)return l.default.allTime;const s=[],a=[];for(const i of n)"feature"!==i?.type&&"map-image"!==i?.type||!i.timeInfo?.hasLiveData?a.push(i):s.push(i);const o=t=>null==t||t.isAllTime,m=[...a.map((t=>{const e=t.timeInfo?.fullTimeExtent,{visibilityTimeExtent:n}=t;return e?.intersection(n)??n})),...r.map((t=>t.visibilityTimeExtent))];if(m.some(o))return l.default.allTime;const c=s.map((async t=>{const n=(await t.fetchRecomputedExtents({signal:e}))?.timeExtent??t.timeInfo?.fullTimeExtent,{visibilityTimeExtent:i}=t;return n?.intersection(i)??i})),f=(await Promise.allSettled(c)).map((t=>"fulfilled"===t.status?t.value:null));if(f.some(o))return l.default.allTime;const p=[...f,...m].filter(i.Ru);return 0===p.length?l.default.allTime:p.reduce(((t,e)=>t.union(e)))}function p(t,e){const n=t.currentTimeExtent;if(!n)return null;const{start:i,end:r}=n,s=i??r??null;switch(e){case"time-window":return new l.default({start:i,end:r});case"cumulative-from-start":return new l.default({start:null,end:s});case"cumulative-from-end":return new l.default({start:s,end:null});case"instant":return new l.default({start:s,end:s})}}async function d(t,e){if(!(0,a.r)(t)&&!function(t){return null!=t&&"object"==typeof t&&o.X in t}(t))return null;await t.load({signal:e});const n=t?.widgets?.timeSlider;if(!n)return null;const i=await m(t,e),r=n.loop,s=function(t){const e=t.numThumbs??2,n=t.currentTimeExtent;if(n){const{start:t,end:i}=n;return null!=t&&null!=i&&t.getTime()===i.getTime()?"instant":2===e?"time-window":null==t||0===t.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===e?"time-window":"cumulative-from-start"}(n);return{fullTimeExtent:i,loop:r,mode:s,playRate:n.stopDelay??2e3,stops:c(n),timeExtent:p(n,s)}}function h(t){if(!t)return t;const{start:e,end:n}=t;return new l.default({start:null!=e?(0,s.S1)(e,-e.getTimezoneOffset(),"minutes"):e,end:null!=n?(0,s.S1)(n,-n.getTimezoneOffset(),"minutes"):n})}function g(t){if(!t)return t;const{start:e,end:n}=t;return new l.default({start:null!=e?(0,s.S1)(e,e.getTimezoneOffset(),"minutes"):e,end:null!=n?(0,s.S1)(n,n.getTimezoneOffset(),"minutes"):n})}}}]);
//# sourceMappingURL=13230.2c6dbe38.chunk.js.map