"use strict";(self.webpackChunkn2_utility=self.webpackChunkn2_utility||[]).push([[73814],{73814:(e,t,r)=>{r.d(t,{load:()=>d});var a=r(50076),n=r(13096),l=r(11668),o=r(77491),s=r(24883),i=r(79942),u=r(64130),c=r(72945),p=r(81589),y=r(67061);async function d(e,t){const r=e.instance.portalItem;if(r?.id)return await r.load(t),function(e){const t=e.instance.portalItem;if(!t?.type||!e.supportedTypes.includes(t.type))throw new a.default("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:t?.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(r),async function(e,t){const r=e.instance,n=r.portalItem;if(!n)return;const{url:s,title:d}=n,m=(0,i.v)(n,"portal-item");if("group"===r.type)return async function(e,t,r){const n=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:s,type:p}=n;if("Group Layer"===p){if(!(0,c.Y)(n,"Map"))throw new a.default("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return async function(e,t){const r=e.portalItem,n=await r.fetchData("json");if(!n)return;if(!t.populateGroupLayer)throw new a.default("portal:missing-populate-group-layer","Missing populate group layer");const l=(0,i.v)(r,"web-map");e.read(n,l),await t.populateGroupLayer(e,n,{context:l}),e.resourceReferences={portalItem:r,paths:l.readResourcePaths??[]}}(e,r)}return e.read({title:s},t),async function(e,t){let r;const{portalItem:n}=e;if(!n)return;const s=n.type,i=t.layerModuleTypeMap;if(!i)throw new a.default("portal:missing-layer-module-type-map","Layer module type map is required to construct sub layers");switch(s){case"Feature Service":case"Feature Collection":r=i.FeatureLayer;break;case"Stream Service":r=i.StreamLayer;break;case"Scene Service":r=i.SceneLayer;break;default:throw new a.default("portal:unsupported-item-type-as-group",`The item type '${s}' is not supported as a 'IGroupLayer'`)}const c=new o.v;let[p,d]=await Promise.all([r(),w(t,c)]),m=()=>p;if("Feature Service"===s){const t=(0,u.pJ)(d)?.customParameters;d=n.url?await(0,u.bO)(d,n.url,c):{},m=await async function(e,t){const{layers:r,tables:a}=e,n=[...r??[],...a??[]];if(!n.length)return;const l=new Set,o=[];for(const{layerType:c}of n){const e=c??"ArcGISFeatureLayer";if(l.has(e))continue;l.add(e);const r=t[(0,u.K8)(e)];o.push(r())}const s=await Promise.all(o),i=new Map;return Array.from(l).forEach(((e,t)=>{i.set(e,s[t])})),e=>{let{layerType:t}=e;const r=t??"ArcGISFeatureLayer";return i.get(r)}}(d,i)||m;const r=await async function(e,t){const{layersJSON:r}=await(0,l.Q)(e,t);if(!r)return null;const a=[...r.layers,...r.tables];return e=>a.find((t=>t.id===e.id))}(n.url,{customParameters:t,loadContext:c});return await f(e,m,m,d,i,r)}return"Scene Service"===s&&n.url&&(d=await(0,u.nu)(n,d,c)),(0,u.XH)(d)>0?await f(e,m,null,d,i):await async function(e,t,r){const{portalItem:a}=e;if(!a?.url)return;const n=await(0,y.V)(a.url);n&&f(e,t,null,{layers:n.layers?.map(u._r),tables:n.tables?.map(u._r)},r)}(e,m,i)}(e,r)}(r,m,e);s&&"media"!==r.type&&r.read({url:s},m);const h=new o.v,g=await w(e,h,t);return g&&r.read(g,m),r.resourceReferences={portalItem:n,paths:m.readResourcePaths??[]},"subtype-group"!==r.type&&r.read({title:d},m),(0,p.L)(r,m)}(e,t)}async function f(e,t,r,a,n,l){let o=a.layers||[];const s=a.tables||[];if("Feature Collection"===e.portalItem?.type?(o.forEach(((e,t)=>{e.id=t,"Table"===e?.layerDefinition?.type&&s.push(e)})),o=o.filter((e=>"Table"!==e?.layerDefinition?.type))):(o.reverse(),s.reverse()),o.forEach((r=>{const n=l?.(r);if(n||!l){const l=m(e,t(r),a,r,n);e.add(l)}})),s.length){const t=r?null:await n.FeatureLayer();s.forEach((n=>{const o=l?.(n);if(o||!l){const l=m(e,r?r(n):t,a,n,o);e.tables.add(l)}}))}}function m(e,t,r,a,n){const l=e.portalItem,o={portalItem:l.clone(),layerId:a.id};null!=a.url&&(o.url=a.url);const i=new t(o);if("sourceJSON"in i&&(i.sourceJSON=n),"subtype-group"!==i.type&&"catalog"!==i.type&&(i.sublayerTitleMode="service-name"),"Feature Collection"===l.type){const e={origin:"portal-item",portal:l.portal||s.default.getDefault()};i.read(a,e);const t=r.showLegend;null!=t&&i.read({showLegend:t},e)}return i}async function w(e,t,r){if(!1===e.supportsData)return;const a=e.instance,l=a.portalItem;if(!l)return;let o=null;try{o=await l.fetchData("json",r)}catch(s){}if(function(e){return"stream"!==e.type&&"layerId"in e}(a)){let e=null;const r=await async function(e,t,r){if(t?.layers&&t?.tables)return(0,u.XH)(t);const a=(0,n.qg)(e.url);if(!a)return 1;const l=await r.fetchServiceMetadata(a.url.path,{customParameters:(0,u.pJ)(t)?.customParameters}).catch((()=>null));return(t?.layers?.length??l?.layers?.length??0)+(t?.tables?.length??l?.tables?.length??0)}(l,o,t);if((o?.layers||o?.tables)&&r>0){if(null==a.layerId){const e=(0,u.l)(a.type),t=e?.length?(0,u.Ju)(o,e)[0]:(0,u.pJ)(o);t&&(a.layerId=t.id)}e=function(e,t){const{layerId:r}=t,a=e.layers?.find((e=>e.id===r))||e.tables?.find((e=>e.id===r));return a&&function(e,t){const r="layerType"in e&&e.layerType,{type:a}=t;return!("feature"===a&&r&&"ArcGISFeatureLayer"!==e.layerType||"catalog"===a&&!r||"oriented-imagery"===a&&!r||"subtype-group"===a&&!r)}(a,t)?a:null}(o,a),"OrientedImageryLayer"===e?.layerType&&"oriented-imagery"===a.type&&a.supportedSourceTypes.add("Feature Layer"),e&&null!=o.showLegend&&(e.showLegend=o.showLegend)}return r>1&&"sublayerTitleMode"in a&&"service-name"!==a.sublayerTitleMode&&(a.sublayerTitleMode="item-title-and-service-name"),e}return o}}}]);
//# sourceMappingURL=73814.5197d83c.chunk.js.map