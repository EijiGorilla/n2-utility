"use strict";(self.webpackChunkn2_utility=self.webpackChunkn2_utility||[]).push([[58304],{58304:(t,e,i)=>{i.r(e),i.d(e,{OperatorShapePreservingProject:()=>L});var s=i(68707),n=i(97799),o=i(91523),r=i(21557),h=i(79186),m=i(26871),a=i(16364),l=i(82103),c=i(88689);function u(t){const e=t.getInputSR(),i=t.getOutputSR();let s=!1;do{if(e.equals(i)){s=!1;break}if(!d(e)||!d(i)){s=!1;break}if(2===e.getCoordinateSystemType()){s=!0;break}if(2===i.getCoordinateSystemType()){s=!0;break}const n=t.getGeographicTransformations();if(null!==n&&n.count()>0){s=!0;break}}while(0);return s}class f{constructor(t,e,i,s){this.m_horizon2Env=new r.Envelope2D,this.m_horizon2=t,this.m_sr=e,this.m_bInclusive2=i,this.m_pannableExtent=s.clone(),this.m_segIter=null,this.m_qtIter=null,null!==t?(t.queryEnvelope(this.m_horizon2Env),this.m_gcs360=s.width(),this.m_gcs180=.5*this.m_gcs360,this.m_gcs90=.25*this.m_gcs360,this.m_pannableFactor=1,this.m_horizon2Env.width()-this.m_gcs360>0&&(this.m_pannableFactor+=Math.ceil((this.m_horizon2Env.width()-this.m_gcs360)/this.m_gcs360)),this.m_period=this.m_gcs360):(this.m_horizon2Env.setEmpty(),this.m_gcs360=Number.NaN,this.m_gcs180=Number.NaN,this.m_gcs90=Number.NaN,this.m_pannableFactor=Number.NaN,this.m_period=Number.NaN),this.m_gcsTolerance=null!=e?e.getTolerance(0):Number.NaN}isPointStartInHorizon(t,e){if(!this.m_horizon2)return!0;let i=v(new o.P(t),this.m_horizon2,!0,this.m_period);do{const e=t.clone();if(e.x-=i*this.m_period,this.m_horizon2.getGeometryType()===n.G.enumPolygon){let t;if(t=this.m_horizon2Env.contains(e)?(0,l.i)(this.m_horizon2,e,0):0,this.m_bInclusive2){if(0===t)return!1}else if(1===t)return!1}else{const t=this.m_horizon2Env.contains(e);if(this.m_bInclusive2){if(!t)return!1}else if(t)return!1}}while(this.m_horizon2Env.xmin+ ++i*this.m_period<t.x);return!0}isAdjoiningLineInHorizon(t,e,i){if(!this.m_horizon2)return!0;const s=new m.P,o=new m.P;w(t,e,this.m_gcs90,this.m_gcs180,this.m_gcs360,s,o);const a=Math.max(s.x,o.x),l=new h.L;l.setStart2D(s),l.setEnd2D(o);let c=v(l,this.m_horizon2,!0,this.m_period);do{const t=s.clone(),e=o.clone();if(t.x-=c*this.m_period,e.x-=c*this.m_period,this.m_horizon2.getGeometryType()===n.G.enumPolygon){const i=new h.L;i.setStartXY(t),i.setEndXY(e);const s=new r.Envelope2D,o=new r.Envelope2D;if(i.queryEnvelope(s),o.setCoords({env2D:s}),o.inflateCoords(this.m_gcsTolerance,this.m_gcsTolerance),this.m_horizon2Env.isIntersecting(o)){const t=this.m_horizon2.getImpl(),e=t.getAccelerators();null!==e&&null!==e.getRasterizedGeometry()&&(0,n.g)(0);{let s=null;if(null!==e&&(s=e.getQuadTree()),null!==s){this.m_qtIter||(this.m_qtIter=s.getIteratorForQT()),this.m_qtIter.resetIterator(i,this.m_gcsTolerance),this.m_segIter||(this.m_segIter=t.querySegmentIterator());for(let t=this.m_qtIter.next();-1!==t;t=this.m_qtIter.next()){const e=s.getElement(t);if(this.m_segIter.resetToVertex(e,-1),this.m_segIter.nextSegment().isIntersecting(i,this.m_gcsTolerance))return!1}}else for(this.m_segIter||(this.m_segIter=t.querySegmentIterator()),this.m_segIter.resetToFirstPath();this.m_segIter.nextPath();)for(;this.m_segIter.hasNextSegment();){const t=this.m_segIter.nextSegment(),e=new r.Envelope2D;if(t.queryEnvelope(e),e.isIntersecting(o)&&t.isIntersecting(i,this.m_gcsTolerance))return!1}}}}else if(this.m_bInclusive2){const i=this.m_horizon2Env.contains(t),s=this.m_horizon2Env.contains(e);if(i&&s)return!0}else{const i=this.m_horizon2Env.clone();if(i.inflateCoords(this.m_gcsTolerance,this.m_gcsTolerance),0!==i.clipLine(t,e))return!1}}while(this.m_horizon2Env.xmin+ ++c*this.m_period<a);return!this.m_bInclusive2||!1}isEnvelopeInHorizon(t,e){if(!this.m_horizon2)return!0;const i=new o.E({env2D:t});let s=v(i,this.m_horizon2,!0,this.m_period);do{const n=t.clone();if(n.move(-s*this.m_period,0),i.setCoords(n.xmin,n.ymin,n.xmax,n.ymax),!N(i,this.m_horizon2,this.m_sr,this.m_bInclusive2,e))return!1}while(this.m_horizon2Env.xmin+ ++s*this.m_period<t.xmax);return!0}}class g{constructor(t,e,i){this.m_splitLines2=null,this.m_scalars=[],this.m_splitIter=null,this.m_splitLines2=t,this.m_transform1=e,this.m_pannableExtent=i.clone(),this.m_gcs360=i.width(),this.m_gcs180=.5*this.m_gcs360,this.m_gcs90=.25*this.m_gcs360,null!==e?(this.m_gcsTolerance=this.m_transform1.getOutputSR().getTolerance(0),this.m_halfGcsTolerance=.5*this.m_gcsTolerance,this.m_gcsToleranceSq=this.m_gcsTolerance*this.m_gcsTolerance):(this.m_gcsTolerance=Number.NaN,this.m_halfGcsTolerance=Number.NaN,this.m_gcsToleranceSq=Number.NaN)}hasSplitLines(){return null!=this.m_splitLines2}getSplitLineFactorEx(t,e,i,s,n,o){const a=new m.P,l=new m.P;w(s,n,this.m_gcs90,this.m_gcs180,this.m_gcs360,a,l);const c=new h.L;for(c.setStartXY(a),c.setEndXY(l),this.m_splitIter?this.m_splitIter.resetToFirstPath():this.m_splitIter=this.m_splitLines2.getImpl().querySegmentIterator();this.m_splitIter.nextPath();)for(;this.m_splitIter.hasNextSegment();){const s=this.m_splitIter.nextSegment(),n=.5*(s.getStartX()+s.getEndX());x(this.m_gcs180,this.m_gcs360,n,c);const h=new r.Envelope2D;c.queryEnvelope(h),h.inflateCoords(this.m_gcsTolerance,this.m_gcsTolerance);const m=new r.Envelope2D;if((s.queryEnvelope(m),h.isIntersecting(m))&&(this.m_scalars.length<2&&(this.m_scalars.length=2),1===c.intersect(s,null,this.m_scalars,null,this.m_gcsTolerance)&&this.m_scalars[0]>0&&this.m_scalars[0]<1)){const n=k(e,i,this.m_scalars[0]),r=D(t.getCoord2D(n),this.m_transform1);return s.isIntersectingPoint(r,this.m_halfGcsTolerance)?n:this.getSplitLineFactor(t,e,i,s,o)}}return-1}getSplitLineFactor(t,e,i,s,n){let o=e,r=i;const a=.5*(s.getStartX()+s.getEndX()),l=new h.L,c=t.getCoord2D(o),u=t.getCoord2D(r),f=D(c,this.m_transform1),g=D(u,this.m_transform1);for(;o<r;){const e=new m.P,i=new m.P;w(f,g,this.m_gcs90,this.m_gcs180,this.m_gcs360,e,i),l.setStartXY(e),l.setEndXY(i),x(this.m_gcs180,this.m_gcs360,a,l);const n=m.P.sqrDistance(l.getStartXY(),l.getEndXY());if(n<=this.m_gcsToleranceSq)break;if(Number.isNaN(n))return Number.NaN;let h=k(o,r,this.m_scalars[0]);if(o<h&&h<r||(h=.5*(r+o)),o===h||h===r)return h;const _=t.getCoord2D(h),d=D(_,this.m_transform1),p=new m.P;w(f,d,this.m_gcs90,this.m_gcs180,this.m_gcs360,e,p),l.setStartXY(e),l.setEndXY(p),x(this.m_gcs180,this.m_gcs360,a,l);let P=l.intersect(s,null,this.m_scalars,null,this.m_halfGcsTolerance);if(0!==P){if(1===this.m_scalars[0])return h;r=h,u.setCoordsPoint2D(_),g.setCoordsPoint2D(d)}else{if(w(d,g,this.m_gcs90,this.m_gcs180,this.m_gcs360,p,i),l.setStartXY(p),l.setEndXY(i),x(this.m_gcs180,this.m_gcs360,a,l),P=l.intersect(s,null,this.m_scalars,null,this.m_halfGcsTolerance),0===P)return h;if(0===this.m_scalars[0])return h;o=h,c.setCoordsPoint2D(_),f.setCoordsPoint2D(d)}}return.5*(r+o)}}class _{constructor(){this.m_bPrepared=!1,this.m_bNeedsShapePreservingProject=!1,this.m_inputTransform=null,this.m_transform1=null,this.m_transform2=null,this.m_extentFrom=null,this.m_horizon1=null,this.m_horizon2=null,this.m_pannableExtentFrom=new r.Envelope2D,this.m_pannableExtentTo=new r.Envelope2D,this.m_pannableExtentGcsTo=new r.Envelope2D,this.m_bClipTopBottomFrom=!1,this.m_bNeedsGeoTransform=!1,this.m_bIsPannableFrom=!1,this.m_bIsPannableTo=!1,this.m_bInclusive1=!1,this.m_bInclusive2=!1,this.m_bSrFromIsPcs=!1,this.m_bSrToIsPcs=!1,this.m_fromTolerance=Number.NaN,this.m_toTolerance=Number.NaN,this.m_gcsToTolerance=Number.NaN,this.m_aFrom=Number.NaN,this.m_mpuFrom=Number.NaN,this.m_rpuFrom=Number.NaN,this.m_rpuGcsTo=Number.NaN,this.m_aTo=Number.NaN,this.m_mpuTo=Number.NaN,this.m_stages=0}prepare(t,e,i){this.m_bPrepared&&(0,n.m)(""),t||(0,n.t)("");const s=t.getInputSR(),o=t.getOutputSR();d(s)&&d(o)||(0,n.t)("shape preserving project requires PCS or GCS");const r=s.getCoordinateSystemType(),h=o.getCoordinateSystemType();this.m_bSrFromIsPcs=2===r,this.m_bSrToIsPcs=2===h;let m=null,a=null,c=null,u=null;this.m_bSrFromIsPcs?(m=s,c=s.getGCS(),this.m_aFrom=z(c),this.m_mpuFrom=G(m),this.m_rpuFrom=Number.NaN):(c=s,this.m_rpuFrom=y(c),this.m_aFrom=Number.NaN),this.m_bSrToIsPcs?(a=o,u=o.getGCS(),this.m_aTo=z(u),this.m_mpuTo=G(a)):(u=o,this.m_aTo=Number.NaN,this.m_mpuTo=Number.NaN),this.m_rpuGcsTo=y(u);const f=t.getGeographicTransformations();this.m_bNeedsGeoTransform=null!==f&&f.count()>0;const g=s.equals(o);if(this.m_bNeedsShapePreservingProject=!g&&(this.m_bSrFromIsPcs||this.m_bSrToIsPcs||this.m_bNeedsGeoTransform),!this.m_bNeedsShapePreservingProject)return this.m_inputTransform=t,this.m_extentFrom=e?e.clone():null,void(this.m_bPrepared=!0);if(this.m_bIsPannableFrom=s.isPannable(),this.m_bIsPannableTo=o.isPannable(),this.m_bIsPannableFrom&&(this.m_pannableExtentFrom=s.getPannableExtent()),this.m_bIsPannableTo&&(this.m_pannableExtentTo=o.getPannableExtent()),this.m_bSrToIsPcs){this.m_pannableExtentGcsTo=u.getPannableExtent();const t=a.getCentralMeridian(),e=this.m_pannableExtentGcsTo.getCenter();e.x=t,this.m_pannableExtentGcsTo.centerAt(e)}else this.m_pannableExtentGcsTo=this.m_pannableExtentTo.clone();this.m_fromTolerance=s.getTolerance(0),this.m_toTolerance=o.getTolerance(0),this.m_gcsToTolerance=u.getTolerance(0);{const s=t.getExtendedParams(),n=s.clipWithInputHorizon,o=s.clipWithOutputHorizon;n&&this.setHorizon1(t,e,i),o&&this.setHorizon2(t,i),this.checkAndSetStages(t,i)}const _=(0,l.aa)();_.setFlag(1073741824,!0),_.setFlag(536870912,!0);const p=(0,l.ab)();if(p.clipWithInputHorizon=!1,p.clipWithOutputHorizon=!1,1===this.m_stages)this.m_transform1=(0,l.a8)(!1,s,o,f,p,_);else if(2===this.m_stages){_.setFlag(2147483648,!0),this.m_transform1=(0,l.a8)(!1,s,u,f,p,_);const t=(0,l.aa)();this.m_transform2=(0,l.a8)(!1,u,o,null,p,t)}else{(0,n.g)(null!=a),p.centralMeridianOfOutputGCS=a.getCentralMeridian(),this.m_transform1=(0,l.a8)(!1,s,u,f,p,_);const t=(0,l.aa)();t.setFlag(2147483648,!0),this.m_transform2=(0,l.a8)(!1,u,o,null,p,t)}this.m_inputTransform=t,this.m_extentFrom=e?e.clone():null,this.m_bPrepared=!0}execute(t,e,i,s){return this.m_bPrepared||(0,n.m)(""),(0,n.g)(!t.hasAttribute(10)),this.execute_(t,e,i,s)}checkIfNeedsReset(t,e){return(0,n.g)(0),!1}setHorizon1(t,e,i){const s=t.getInputSR();let n,h=null;const m=new r.Envelope2D;if(this.m_bSrFromIsPcs){n=!0,h=s.getPCSHorizon(),h.queryEnvelope(m),this.m_bIsPannableFrom&&(h=new o.E({xmin:this.m_pannableExtentFrom.xmin,ymin:m.ymin,xmax:this.m_pannableExtentFrom.xmax,ymax:m.ymax}));let t=!1;null!=e&&(t=function(t,e,i,s,n,o,r){const h=[!1];return C(t,i,e,s,n,o,!0,Number.NaN,h,r),h[0]}(e,h,s,n,this.m_bIsPannableFrom,this.m_pannableExtentFrom,i)),t||(this.m_horizon1=h,this.m_bInclusive1=n)}else this.m_bClipTopBottomFrom=!0,this.m_bInclusive1=!0}setHorizon2(t,e){const i=t.getOutputSR();if(1===i.getCoordinateSystemType())return this.m_horizon2=null,void(this.m_bInclusive2=!1);let s=null;const n=new r.Envelope2D,h=i.getGCSHorisonIsInclusive();s=i.getGCSHorizon(),s.queryEnvelope(n);const m=i.getCentralMeridian();if(this.m_bIsPannableTo){const t=new o.E({xmin:this.m_pannableExtentGcsTo.xmin,ymin:n.ymin,xmax:this.m_pannableExtentGcsTo.xmax,ymax:n.ymax});t.centerAt(m,0),s=t}this.m_horizon2=s,this.m_bInclusive2=h}checkAndSetStages(t,e){const i=t.getOutputSR().getGCSSplitLines();if(this.m_horizon2||i){if(this.m_horizon2.getGeometryType()===n.G.enumEnvelope){const t=new r.Envelope2D;this.m_horizon2.queryEnvelope(t);const e=t.width(),i=t.height();e>=m.k/this.m_rpuGcsTo&&i>=Math.PI/this.m_rpuGcsTo&&(this.m_horizon2=null)}if(this.m_horizon2||i){if(null!==this.m_horizon2&&!this.m_bNeedsGeoTransform&&!this.m_bSrFromIsPcs){const e=t.getOutputSR().getGCS();return t.getInputSR().equals(e)?(this.m_horizon1=this.m_horizon2,this.m_bInclusive1=this.m_bInclusive2,this.m_bClipTopBottomFrom=!1,this.m_horizon2=null,this.m_bInclusive2=!1,void(this.m_stages=1)):void(this.m_stages=2)}this.m_stages=3}else this.m_stages=1}else this.m_stages=1}execute_(t,e,i,s){if(!this.m_bNeedsShapePreservingProject)return(new l.v).execute(t,this.m_inputTransform,s);if(!t)return null;(0,n.d)(t),(0,n.l)(t);let o,r=t.getGeometryType();return(0,n.f)(r)?(o=function(t){const e=new h.P({vd:t.getDescription()});return e.addSegment(t,!0),e}(t),r=n.G.enumPolyline):o=t,o.isEmpty()?o:(0,n.h)(r)?this.executeEx(t,e,i,s):(new l.v).execute(t,this.m_inputTransform,s)}executeEx(t,e,i,s){let o;t.hasNonLinearSegments()&&(0,n.b)(""),o=this.m_bIsPannableFrom?(new l.v).foldInto360Range(t,this.m_transform1.getInputSR()):t;let r,h=i;return h>0||(h=100*this.m_toTolerance),r=1===this.m_stages?this.executeGood(o,e,h,s):2===this.m_stages?this.executeBad(o,e,h,s):this.executeUgly(o,e,h,s),this.filterOverDensification(r,this.m_inputTransform.getOutputSR(),h,s)}executeGood(t,e,i,s){const n=i*i;let o,r;return o=e>0?this.getMinLengthInSrFrom(e):this.getMinLengthInSrFrom(1e-5),r=this.m_bClipTopBottomFrom?(0,l.w)(t,this.m_transform1.getInputSR()):F(t,this.m_transform1.getInputSR(),this.m_horizon1,this.m_bInclusive1,this.m_bIsPannableFrom,this.m_pannableExtentFrom,!0,Number.NaN,s),r=(0,l.a9)(r,this.m_transform1.getOutputSR(),s),r=p(r,this.m_transform1,this.m_bIsPannableFrom,this.m_pannableExtentFrom,this.m_bIsPannableTo,this.m_pannableExtentTo,null,null,null,null,o,n,s),r=(new l.v).execute(r,this.m_transform1,s),r}executeBad(t,e,i,s){let n;n=e>0?e*(Math.PI/180/this.m_rpuGcsTo):Math.PI/180/this.m_rpuGcsTo*1e-5;const o=i*i;let r;return r=this.m_bClipTopBottomFrom?(0,l.w)(t,this.m_transform1.getInputSR()):t,r=(new l.v).execute(r,this.m_transform1,s),r=F(r,this.m_transform2.getInputSR(),this.m_horizon2,this.m_bInclusive2,!0,this.m_pannableExtentGcsTo,!0,Number.NaN,s),r=(0,l.a9)(r,this.m_transform2.getOutputSR(),s),r=p(r,this.m_transform2,!0,this.m_pannableExtentGcsTo,this.m_bIsPannableTo,this.m_pannableExtentTo,null,null,null,null,n,o,s),r=(new l.v).execute(r,this.m_transform2,s),r}executeUgly(t,e,i,s){const n=i*i;let o;o=e>0?this.getMinLengthInSrFrom(e):this.getMinLengthInSrFrom(1e-5);let r=null;r=this.m_bClipTopBottomFrom?(0,l.w)(t,this.m_transform1.getInputSR()):F(t,this.m_transform1.getInputSR(),this.m_horizon1,this.m_bInclusive1,this.m_bIsPannableFrom,this.m_pannableExtentFrom,!0,Number.NaN,s);let h=r;const m=new f(this.m_horizon2,this.m_transform2.getInputSR(),this.m_bInclusive2,this.m_pannableExtentGcsTo),a=this.m_transform2.getOutputSR().getGCSSplitLines(),c=new g(a,this.m_transform1,this.m_pannableExtentGcsTo);if(r=p(r,this.m_transform1,this.m_bIsPannableFrom,this.m_pannableExtentFrom,this.m_bIsPannableTo,this.m_pannableExtentTo,this.m_transform2,m,this.m_pannableExtentGcsTo,c,o,n,s),null!==r){h=null,r=(new l.v).execute(r,this.m_transform1,s);const t=Math.PI/180/this.m_rpuGcsTo*2;return r=F(r,this.m_transform2.getInputSR(),this.m_horizon2,this.m_bInclusive2,!0,this.m_pannableExtentGcsTo,!1,t,s),r=(new l.v).execute(r,this.m_transform2,s),r}let u=Number.NaN;u=i>0?i:100*this.m_toTolerance,u/=this.m_rpuGcsTo*this.m_aTo/this.m_mpuTo;const _=u*u;let d;return r=p(h,this.m_transform1,this.m_bIsPannableFrom,this.m_pannableExtentFrom,!0,this.m_pannableExtentGcsTo,null,null,null,null,o,_,s),h=null,r=(new l.v).execute(r,this.m_transform1,s),d=e>0?e*(Math.PI/180/this.m_rpuGcsTo):Math.PI/180/this.m_rpuGcsTo*1e-5,r=F(r,this.m_transform2.getInputSR(),this.m_horizon2,this.m_bInclusive2,!0,this.m_pannableExtentGcsTo,!1,Number.NaN,s),r=(0,l.a9)(r,this.m_transform2.getOutputSR(),s),r=p(r,this.m_transform2,!0,this.m_pannableExtentGcsTo,this.m_bIsPannableTo,this.m_pannableExtentTo,null,null,null,null,d,n,s),r=(new l.v).execute(r,this.m_transform2,s),r}getMinLengthInSrFrom(t){let e;return e=this.m_bSrFromIsPcs?this.m_aFrom*(t*Math.PI/180)/this.m_mpuFrom:t*Math.PI/180*(1/this.m_rpuFrom),e}filterOverDensification(t,e,i,s){let r=function(t,e){if(t.isEmpty()||!t.hasAttribute(10))return t;const i=e*e;let s=t.getAttributeStreamRef(10),n=!1;const r=new h.L,a=[];let l=!1;for(let o=0,h=t.getPathCount();o<h;o++){const e=t.getPathStart(o),h=t.getPathEnd(o),c=t.isClosedPath(o);if(!(h>e))continue;{const t=c?e:h-1;0===s.read(e)&&0===s.read(t)||(n||(s=s.clone(),n=!0),s.write(e,0),s.write(t,0))}const u=c?h+1:h;let f=e;for(let o=e;o<u;o++){const c=o===h?e:o;if(0===s.read(c)){if(o-f>1){a.push({from:f,to:o});const c=new m.P;for(;a.length>0;){const o=a.at(-1);a.pop(),r.setStartXY(t.getXY(o.from));const u=o.to===h?e:o.to;r.setEndXY(t.getXY(u));let f=i,g=-1;for(let e=o.from+1,i=o.to;e<i;e++){const i=t.getXY(e),s=r.getClosestCoordinate(i,!1);r.queryCoord2D(s,c);const n=m.P.sqrDistance(c,i);f<n&&(f=n,g=e)}g>=0?(n||(s=s.clone(),n=!0),s.write(g,0),g-o.from>1&&a.push({from:o.from,to:g}),o.to-g>1&&a.push({from:g,to:o.to})):l=!0}}f=c}}}if(!l)return t;const c=function(t,e,i){const s=t.createInstance(),n=new o.P;for(let o=0,r=t.getPathCount();o<r;o++){let r=!0,h=0,m=0;const a=t.getPathStart(o),l=t.getPathEnd(o);let c=!0;for(let u=a;u<l;u++)e.read(u)===i?(!c&&m>0&&(s.addSegmentsFromPath(t,o,h-a,m,r),m=0),c=!0):c?(c=!1,t.getPointByVal(u,n),r?(s.startPathPoint(n),r=!1):s.lineToPoint(n),h=u):m++;m>0&&s.addSegmentsFromPath(t,o,h-a,m,r)}return s}(t,s,1);return c.dropAttribute(10),c}(t,i);return r.dropAttribute(10),r!==t&&r.getGeometryType()===n.G.enumPolygon&&(r=(new l.g).execute(r,e,!1,s)),r}}function d(t){if(!t)return!1;const e=t.getCoordinateSystemType();return 2===e||1===e}function p(t,e,i,s,n,o,r,m,a,l,c,u,f){const g=t.createInstance();g.addAttribute(10);const _=t.querySegmentIterator(),d=[],p=[],D=new h.S,b=t.getDescription().getAttributeCount()>1,x=new q(e,i,s,n,o,r,m,l,c,u,b?p:null,d,f);for(;_.nextPath();)for(;_.hasNextSegment();){const t=_.nextSegment(),e=t.getStartXY(),i=t.getEndXY(),s=e.compare(i)>0,n=S(s,t,D);if(d.length=0,p.length=0,!x.densifySegment(_.isFirstSegmentInPath(),n))return null;s&&I(b?p:null,d),d.at(-1).setCoordsPoint2D(t.getEndXY());const o=g.getPointCount();if(b){const e=S(s,t,D);T(_.isFirstSegmentInPath(),_.isLastSegmentInPath()&&!_.isPathClosed(),t,e,p,d,g)}else P(_.isFirstSegmentInPath(),_.isLastSegmentInPath()&&!_.isPathClosed(),d,g);if(x.needsPostFiltering()){g.addAttribute(10);const t=g.getAttributeStreamRef(10);for(let e=1,i=d.length-1;e<i;e++)t.write(e+o,1)}}return g}function P(t,e,i,s){t&&s.insertPath2D(-1,null,0,0,!0);const n=s.getPathCount()-1;e?s.insertPointsFromPoints(n,-1,i,0,i.length,!0):s.insertPointsFromPoints(n,-1,i,0,i.length-1,!0)}function T(t,e,i,s,n,r,h){h.reserve(h.getPointCount()+r.length-1);const m=new o.P;if(i.queryStart(m),t?h.startPathPoint(m):h.lineToPoint(m),r.length>2){const t=s.calculateLength2D();for(let e=1;e<r.length-1;e++){const i=s.lengthToT(n[e]*t);s.queryCoord(i,m),m.setXY(r[e]),h.lineToPoint(m)}}e&&(i.queryEnd(m),h.lineToPoint(m))}function D(t,e){const i=e.getInputSR(),s=e.getOutputSR(),n=new m.P;2===i.getCoordinateSystemType()?(n.setCoordsPoint2D(t),(0,l.S)(i,0,[n],1)):n.setCoordsPoint2D(t);const o=new m.P;o.setCoordsPoint2D(n),(0,l.ac)(e,[o],null,1,!1);const r=new m.P;return 2===s.getCoordinateSystemType()?(r.setCoordsPoint2D(o),(0,l.R)(s,[r],1,!1)):r.setCoordsPoint2D(o),r}function b(t,e,i,s,n,o,r,h){if(n){const n=o.width(),a=.5*n;if(s){const s=.25*n;let o=!1;const l=new m.P,c=new m.P;if(Math.abs(t.y)===s?(l.setCoords(i.x,t.y),c.setCoordsPoint2D(i),o=!0):Math.abs(i.y)===s&&(c.setCoords(t.x,i.y),l.setCoordsPoint2D(t),o=!0),Math.abs(e.y)===s&&(o||(l.setCoordsPoint2D(t),c.setCoordsPoint2D(i),o=!0),l.x=e.x),o)return E(e,l,a,n,r),E(e,c,a,n,h),!0}let l=0;t.x-e.x>a&&i.x-e.x>a?l-=n:e.x-t.x>a&&e.x-i.x>a&&(l+=n),Math.abs(e.x-(t.x+l))<a?(r.setCoordsPoint2D(t),E(r,i,a,n,h),r.x+=l,h.x+=l):(r.setCoordsPoint2D(i),E(r,t,a,n,h),r.x+=l,h.x+=l)}else r.setCoordsPoint2D(t),h.setCoordsPoint2D(i);return!1}function S(t,e,i){return t?(i.create(e.getGeometryType()),e.copyTo(i.get()),i.get().reverse(),i.get()):e}function I(t,e){e.reverse(),null!==t&&t.reverse()}function x(t,e,i,s){const n=.5*(s.getStartX()+s.getEndX());if(n-i>t){const t=new a.T;t.setShiftCoords(-e,0),s.applyTransformation(t)}else if(i-n>t){const t=new a.T;t.setShiftCoords(e,0),s.applyTransformation(t)}}function F(t,e,i,s,n,o,h,m,l){const c=[!1];h&&C(t,e,i,s,n,o,!0,m,c,l);let u=t;return c[0]||(u=C(u,e,i,s,n,o,!1,m,null,l)),u=function(t,e,i,s){let n;if(!e)return t;const o=i.getCenter().x,h=i.width(),m=.5*h,l=new r.Envelope2D;t.queryEnvelope(l);const c=l.getCenter().x;let u=0;c-o>m?u=-Math.ceil((c-o-m)/h)*h:o-c>m&&(u=Math.ceil((o-c-m)/h)*h);if(0!==u){n=s?t:t.clone();const e=new a.T;e.setShiftCoords(u,0),n.applyTransformation(e)}else n=t;return n}(u,n,o,u!==t),u}function C(t,e,i,s,o,h,m,u,f,g){if(m&&(f[0]=!1),null==i)return t;const _=new r.Envelope2D,d=new r.Envelope2D;i.queryEnvelope(_),t.queryEnvelope(d);const p=t.getGeometryType(),P=i.getGeometryType(),T=e.getTolerance(0);if(!o){if(m)return f[0]=N(t,i,e,s,g),null;let o;return o=s?P===n.G.enumEnvelope?(0,c.c)(t,_,T,u,g):(new l.f).execute(t,i,e,g):(new l.e).execute(t,i,e,g),o===i&&(o=i.clone()),o}const D=h.width(),b=D*Math.ceil(_.width()/D);let S=null;if(s){let h=v(t,i,o,b),I=0;const x=new a.T;do{let o=null;if(P===n.G.enumEnvelope){const n=i.clone();if(x.setShiftCoords(h*b,0),n.applyTransformation(x),m){if(f[0]=N(t,n,e,s,g),!f[0])return null}else{const e=new r.Envelope2D;n.queryEnvelope(e),o=(0,c.c)(t,e,T,u,g)}}else{const n=t.clone();if(x.setShiftCoords(-h*b,0),n.applyTransformation(x),m){if(f[0]=N(n,i,e,s,g),!f[0])return null}else o=(new l.f).execute(n,i,e,g),o===i&&(o=i.clone())}if(!m){if(o.isEmpty())continue;if(p===n.G.enumPolygon){const t=new r.Envelope2D;if(o.queryEnvelope(t),t.width()<=T)continue}P===n.G.enumEnvelope&&(x.setShiftCoords(-h*b,0),o===t&&(o=o.clone()),o.applyTransformation(x)),null===S?S=o===t?o.clone():o:S.add(o,!1)}I++}while(_.xmin+ ++h*b<d.xmax);if(m)return null;null===S&&(S=t.createInstance()),p===n.G.enumPolygon&&I>1&&D-d.width()<=10*T&&(S=(new l.g).execute(S,e,!0,g))}else{let n=v(t,i,o,b);if(S=t.clone(),0!==n){const t=new a.T;t.setShiftCoords(-n*b,0),S.applyTransformation(t)}do{if(m){if(f[0]=N(S,i,e,s,g),!f[0])return null}else if(S=(new l.e).execute(S,i,e,g),S===i&&(S=i.clone()),S.isEmpty())break;const t=new a.T;t.setShiftCoords(-b,0),S.applyTransformation(t)}while(_.xmin+ ++n*b<d.xmax);if(m)return null;if(!S.isEmpty()&&0!==n){const t=new a.T;t.setShiftCoords(n*b,0),S.applyTransformation(t)}}return S}function N(t,e,i,s,o){let h;if(e.getGeometryType()===n.G.enumPolygon)h=s?(0,l.r)(e,t,i,64,o):(0,l.r)(e,t,i,4,o);else if(s){const i=new r.Envelope2D,s=new r.Envelope2D;e.queryEnvelope(i),t.queryEnvelope(s),h=i.containsEnvelope(s)}else h=(0,l.r)(e,t,i,4,o);return h}function v(t,e,i,s){if(!i)return 0;let n=0;const o=new r.Envelope2D;e.queryEnvelope(o);const h=new r.Envelope2D;t.queryEnvelope(h);const m=o.xmin+s;for(;m+s+n*s>h.xmin;)n--;for(;m+n*s<h.xmin;)n++;return n}function E(t,e,i,s,n){e.x-t.x>i?n.setCoords(e.x-s,e.y):t.x-e.x>i?n.setCoords(e.x+s,e.y):n.setCoordsPoint2D(e)}function w(t,e,i,s,n,o,r){Math.abs(t.y)===i?(o.setCoords(e.x,t.y),r.setCoordsPoint2D(e)):Math.abs(e.y)===i?(o.setCoordsPoint2D(t),r.setCoords(t.x,e.y)):(o.setCoordsPoint2D(t),E(o,e,s,n,r))}function y(t){return t.getUnit().getUnitToBaseFactor()}function G(t){return t.getUnit().getUnitToBaseFactor()}function z(t){return t.getPECoordSys().getDatum().getSpheroid().getAxis()}function k(t,e,i){return i<=.5?t+(e-t)*i:e-(e-t)*(1-i)}class q{checkSegment(){for(let t=0;t<this.n;t++){if(null!==this.pSplitLines2Info&&this.pSplitLines2Info.hasSplitLines()&&!this.bCheckIfNoDensificationNeededForCurve){const t=this.pSplitLines2Info.getSplitLineFactorEx(this.rectifiedSegment,this.leftFactor,this.rightFactor,this.leftGcsToDensifiedPoint,this.rightGcsToDensifiedPoint,this.progressTracker);if(Number.isNaN(t))return-1;if(-1!==t&&this.leftFactor<t&&t<this.rightFactor)return this.cutFactor=t,this.cutFromDensifiedPoint.assign(this.rectifiedSegment.getCoord2D(this.cutFactor)),this.cutToDensifiedPoint.assign(D(this.cutFromDensifiedPoint,this.transform)),this.cutGcsToDensifiedPoint.setCoordsPoint2D(this.cutToDensifiedPoint),this.cutToDensifiedPoint.assign(D(this.cutGcsToDensifiedPoint,this.transform2)),this.midFactor=this.cutFactor,this.midFromDensifiedPoint.setCoordsPoint2D(this.cutFromDensifiedPoint),this.midToDensifiedPoint.setCoordsPoint2D(this.cutToDensifiedPoint),this.midGcsToDensifiedPoint.setCoordsPoint2D(this.cutGcsToDensifiedPoint),1}if(this.cutFactor=k(this.leftFactor,this.rightFactor,this.scalars[t]),this.cutFromDensifiedPoint.assign(this.rectifiedSegment.getCoord2D(this.cutFactor)),this.cutToDensifiedPoint.assign(D(this.cutFromDensifiedPoint,this.transform)),null!==this.transform2&&(this.cutGcsToDensifiedPoint.setCoordsPoint2D(this.cutToDensifiedPoint),this.cutToDensifiedPoint.assign(D(this.cutGcsToDensifiedPoint,this.transform2))),0===t&&(this.midFactor=this.cutFactor,this.midFromDensifiedPoint.setCoordsPoint2D(this.cutFromDensifiedPoint),this.midToDensifiedPoint.setCoordsPoint2D(this.cutToDensifiedPoint),this.midGcsToDensifiedPoint.setCoordsPoint2D(this.cutGcsToDensifiedPoint)),this.bIsPannableFrom&&!this.bCheckIfNoDensificationNeededForCurve&&Math.abs(this.leftFromDensifiedPoint.x-this.rightFromDensifiedPoint.x)>=.25*this.pannableExtentFrom.width())return 1;let e;if(this.bCheckIfNoDensificationNeededForCurve){const t=this.projCurveSegment.get().getClosestCoordinate(this.cutToDensifiedPoint,!1),i=this.projCurveSegment.get().getCoord2D(t);e=m.P.sqrDistance(this.cutToDensifiedPoint,i)}else{const i=new m.P,s=new m.P,n=b(this.leftToDensifiedPoint,this.cutToDensifiedPoint,this.rightToDensifiedPoint,this.bSrToIsGcs,this.bIsPannableTo,this.pannableExtentTo,i,s);this.line.setStartXY(i),this.line.setEndXY(s);const o=this.line.getClosestCoordinate(this.cutToDensifiedPoint,!0);if(n||t>0||Math.abs(o-this.scalars[t])<.3){const t=this.line.getCoord2D(o);e=m.P.sqrDistance(this.cutToDensifiedPoint,t)}else e=2*this.maxDeviationInSrToSq,this.bNeedPostFiltering=!0}if(e>this.maxDeviationInSrToSq)return this.bCheckIfNoDensificationNeededForCurve=!1,1}return 0}constructor(t,e,i,s,n,o,a,l,c,u,f,g,_){this.leftFromDensifiedPoint=new m.P,this.rightFromDensifiedPoint=new m.P,this.cutFromDensifiedPoint=new m.P,this.midFromDensifiedPoint=new m.P,this.leftToDensifiedPoint=new m.P,this.rightToDensifiedPoint=new m.P,this.cutToDensifiedPoint=new m.P,this.midToDensifiedPoint=new m.P,this.line=new h.L,this.leftGcsToDensifiedPoint=new m.P,this.rightGcsToDensifiedPoint=new m.P,this.cutGcsToDensifiedPoint=new m.P,this.midGcsToDensifiedPoint=new m.P,this.bSrToIsGcs=!1,this.bIsCurve=!1,this.leftFactor=0,this.rightFactor=0,this.bIsFirstInPath=!1,this.rectifiedSegment=null,this.transform=null,this.bIsPannableFrom=!1,this.pannableExtentFrom=new r.Envelope2D,this.bIsPannableTo=!1,this.bNeedPostFiltering=!1,this.pannableExtentTo=new r.Envelope2D,this.transform2=null,this.pHorizon2Info=null,this.pSplitLines2Info=null,this.minLengthInSrFrom=0,this.maxDeviationInSrToSq=0,this.cutFactor=0,this.midFactor=0,this.pDensifiedFactors=null,this.pDensifiedPoints=[],this.rightFromDensifiedPointsStack=[],this.rightToDensifiedPointsStack=[],this.rightGcsToDensifiedPointsStack=[],this.rightFactorsStack=[],this.projCurveSegment=new h.S,this.n=0,this.bCheckIfNoDensificationNeededForCurve=!1,this.scalars=(0,m.d)(7,Number.NaN),this.progressTracker=_,this.transform=t,this.bIsPannableFrom=e,this.pannableExtentFrom.assign(i),this.bIsPannableTo=s,this.pannableExtentTo.assign(n),this.transform2=o,this.pHorizon2Info=a,this.pSplitLines2Info=l,this.minLengthInSrFrom=c,this.maxDeviationInSrToSq=u,this.pDensifiedFactors=f,this.pDensifiedPoints=g,this.progressTracker=_,this.bNeedPostFiltering=!1}needsPostFiltering(){return this.bNeedPostFiltering}densifySegment(t,e){if(this.bIsFirstInPath=t,this.rectifiedSegment=e,this.leftGcsToDensifiedPoint.setNAN(),this.rightGcsToDensifiedPoint.setNAN(),this.cutGcsToDensifiedPoint.setNAN(),this.midGcsToDensifiedPoint.setNAN(),this.bSrToIsGcs=null!=this.transform2?1===this.transform2.getOutputSR().getCoordinateSystemType():1===this.transform.getOutputSR().getCoordinateSystemType(),this.bIsCurve=this.rectifiedSegment.isCurve(),this.leftFactor=0,this.rightFactor=1,this.leftFromDensifiedPoint.assign(this.rectifiedSegment.getStartXY()),this.rightFromDensifiedPoint.assign(this.rectifiedSegment.getEndXY()),this.leftToDensifiedPoint.assign(D(this.leftFromDensifiedPoint,this.transform)),this.rightToDensifiedPoint.assign(D(this.rightFromDensifiedPoint,this.transform)),null!==this.transform2&&(this.leftGcsToDensifiedPoint.setCoordsPoint2D(this.leftToDensifiedPoint),this.rightGcsToDensifiedPoint.setCoordsPoint2D(this.rightToDensifiedPoint),this.leftToDensifiedPoint.assign(D(this.leftGcsToDensifiedPoint,this.transform2)),this.rightToDensifiedPoint.assign(D(this.rightGcsToDensifiedPoint,this.transform2)),this.bIsFirstInPath&&!this.pHorizon2Info.isPointStartInHorizon(this.leftGcsToDensifiedPoint,this.progressTracker)))return!1;this.rightFromDensifiedPointsStack.length=0,this.rightToDensifiedPointsStack.length=0,this.rightGcsToDensifiedPointsStack.length=0,this.rightFactorsStack.length=0,this.rightFromDensifiedPointsStack.push(this.rightFromDensifiedPoint.clone()),this.rightToDensifiedPointsStack.push(this.rightToDensifiedPoint.clone()),this.rightFactorsStack.push(this.rightFactor),null!=this.transform2&&this.rightGcsToDensifiedPointsStack.push(this.rightGcsToDensifiedPoint.clone()),null!==this.pDensifiedPoints&&this.pDensifiedPoints.push(this.leftFromDensifiedPoint.clone()),null!==this.pDensifiedFactors&&this.pDensifiedFactors.push(this.leftFactor),this.bIsCurve?this.rectifiedSegment.getGeometryType()===n.G.enumBezier?this.n=7:this.n=5:this.n=3,function(t,e){for(let i=0;i<t;i++){let s=Math.ceil(i/2)/(t+1);i%2!=0&&(s=-s);const n=.5+s;e[i]=n}}(this.n,this.scalars);const i=this.rectifiedSegment.calculateLength2D();if(this.bCheckIfNoDensificationNeededForCurve=!1,this.bIsCurve){const t=new h.P({vd:this.rectifiedSegment.getDescription()});let e=(new l.v).execute(t,this.transform,this.progressTracker);if(null!==this.transform2){const t=new r.Envelope2D;if(e.queryEnvelope(t),!this.pHorizon2Info.isEnvelopeInHorizon(t,this.progressTracker))return!1;e=(new l.v).execute(e,this.transform2,this.progressTracker)}e.getSegmentBuffer(0,this.projCurveSegment,!1),this.bCheckIfNoDensificationNeededForCurve=!0}for(;this.rightFromDensifiedPointsStack.length>0;){let t=!1;if(this.cutFactor=Number.NaN,this.midFactor=Number.NaN,this.midFromDensifiedPoint.setNAN(),this.midToDensifiedPoint.setNAN(),(this.rightFactor-this.leftFactor)*i>this.minLengthInSrFrom){const e=this.checkSegment();if(-1===e)return!1;t=0!==e}if(t)this.rightFromDensifiedPoint.setCoordsPoint2D(this.midFromDensifiedPoint),this.rightToDensifiedPoint.setCoordsPoint2D(this.midToDensifiedPoint),this.rightFactor=this.midFactor,this.rightFromDensifiedPointsStack.push(this.rightFromDensifiedPoint.clone()),this.rightToDensifiedPointsStack.push(this.rightToDensifiedPoint.clone()),this.rightFactorsStack.push(this.rightFactor),null!==this.transform2&&(this.rightGcsToDensifiedPoint.setCoordsPoint2D(this.midGcsToDensifiedPoint),this.rightGcsToDensifiedPointsStack.push(this.rightGcsToDensifiedPoint.clone()));else{if(null!==this.transform2&&!this.pHorizon2Info.isAdjoiningLineInHorizon(this.leftGcsToDensifiedPoint,this.rightGcsToDensifiedPoint,this.progressTracker))return!1;if(this.rightFromDensifiedPointsStack.pop(),this.rightToDensifiedPointsStack.pop(),this.rightFactorsStack.pop(),null!==this.transform2&&this.rightGcsToDensifiedPointsStack.pop(),null!==this.pDensifiedPoints&&this.pDensifiedPoints.push(this.rightFromDensifiedPoint.clone()),null!==this.pDensifiedFactors&&this.pDensifiedFactors.push(this.rightFactor),this.rightFromDensifiedPointsStack.length>0){this.leftFromDensifiedPoint.setCoordsPoint2D(this.rightFromDensifiedPoint),this.leftToDensifiedPoint.setCoordsPoint2D(this.rightToDensifiedPoint),this.leftFactor=this.rightFactor;const t=this.rightFromDensifiedPointsStack.at(-1),e=this.rightToDensifiedPointsStack.at(-1);if(this.rightFromDensifiedPoint.setCoordsPoint2D(t),this.rightToDensifiedPoint.setCoordsPoint2D(e),this.rightFactor=this.rightFactorsStack.at(-1),null!==this.transform2){this.leftGcsToDensifiedPoint.setCoordsPoint2D(this.rightGcsToDensifiedPoint);const t=this.rightGcsToDensifiedPointsStack.at(-1);this.rightGcsToDensifiedPoint.setCoordsPoint2D(t)}}}}return!0}}class L{getOperatorType(){return 10315}supportsCurves(){return!1}accelerateGeometry(t,e,i){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,i,s,n,o){return u(i)?new R(t,e,i,s,n,o):(new l.v).executeMany(t,i,o)}execute(t,e,i,s,n){if(!u(e))return(new l.v).execute(t,e,n);const o=new _;return o.prepare(e,null,n),o.execute(t,i,s,n)}}class R extends s.G{constructor(t,e,i,s,o,r){super(),this.m_spp=null,this.m_index=-1,t||(0,n.t)(""),this.m_progressTracker=r,this.m_geometries=t,this.m_geometriesExtent=e?e.clone():null,this.m_transform=i,this.m_minSegmentLengthInDegrees=s,this.m_maxDeviationInSrTo=o}tock(){return!0}getRank(){return 1}next(){this.m_spp||(this.m_spp=new _,this.m_spp.prepare(this.m_transform,this.m_geometriesExtent,this.m_progressTracker));const t=this.m_geometries.next();return(0,n.d)(t),(0,n.l)(t),null!=t?(this.m_index=this.m_geometries.getGeometryID(),this.m_spp.execute(t,this.m_minSegmentLengthInDegrees,this.m_maxDeviationInSrTo,this.m_progressTracker)):null}getGeometryID(){return this.m_index}}}}]);
//# sourceMappingURL=58304.c8c78fe7.chunk.js.map