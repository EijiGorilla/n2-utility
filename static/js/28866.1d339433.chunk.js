"use strict";(self.webpackChunkn2_utility=self.webpackChunkn2_utility||[]).push([[28866,98156],{28866:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var i=n(35143),r=n(39356),a=n(50076),l=n(46053),u=(n(81806),n(76460),n(47249),n(85842)),s=n(51939),o=n(43543),c=n(59844),m=n(2257);const f=e=>{let t=class extends e{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return(0,o.F)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?(0,c.vI)(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(e){try{return!this.layer.loaded||!!(0,c.eh)(this.layer.serviceRasterInfo,e)}catch{return!1}}async fetchPopupFeaturesAtLocation(e,t){const{layer:n}=this;if(!e)throw new a.default("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:n});const{popupEnabled:i}=n,l=(0,m.D8)(n,t);if(!i||null==l)return[];const u=[],{value:o,magdirValue:c,processedValue:f}=await n.identify(e,{timeExtent:this.timeExtent,signal:t?.signal});let d="";if(o?.length){d="imagery-tile"===n.type&&n.hasStandardTime()&&null!=o[0]?o.map((e=>n.getStandardTimeValue(e))).join(", "):o.join(", ");const e={ObjectId:0};e[s.F_.servicePixelValue]="imagery-tile"===n.type&&"Function"===n.raster.datasetFormat?f?.join(", "):d,e[s.F_.rawServicePixelValue]=d;const t=n.raster?.rasterInfo??n.serviceRasterInfo,i=t?.attributeTable;if(null!=i){const{fields:t,features:n}=i,r=t.find((e=>{let{name:t}=e;return"value"===t.toLowerCase()})),a=e[s.F_.servicePixelValue],l=r?n.find((e=>String(e.attributes[r.name])===a)):null;if(l)for(const i in l.attributes)l.attributes.hasOwnProperty(i)&&(e[s.ER+i]=l.attributes[i])}const a=t?.dataType;if("vector-magdir"!==a&&"vector-uv"!==a||(e[s.F_.magnitude]=c?.[0],e[s.F_.direction]=c?.[1]),"imagery-tile"===n.type){const{multidimensionalDefinition:t}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});(0,s.eS)(n.rasterFields,e,t)}const l=new r.default({geometry:this.fullExtent?.clone(),attributes:e,layer:n,sourceLayer:n});u.push(l)}return u}async getSourceScale(){return await this.layer.load(),(0,c.OO)(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return(0,c.eh)(this.layer.serviceRasterInfo,this.view.spatialReference)}};return(0,i._)([(0,l.MZ)()],t.prototype,"fullExtent",null),(0,i._)([(0,l.MZ)()],t.prototype,"layer",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],t.prototype,"timeExtent",null),(0,i._)([(0,l.MZ)()],t.prototype,"tileInfo",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],t.prototype,"hasTilingEffects",null),(0,i._)([(0,l.MZ)()],t.prototype,"datumTransformation",null),t=(0,i._)([(0,u.$)("esri.views.layers.ImageryTileLayerView")],t),t}},43543:(e,t,n)=>{n.d(t,{F:()=>r});var i=n(98156);function r(e,t,n){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:r=!1,timeOffset:a,useViewTime:l}=e;let u=e.timeExtent;r&&(u=(0,i.toLocalTimeExtent)(u));let s=l?t&&u?t.intersection(u):t||u:u;return!s||s.isEmpty||s.isAllTime?s:(a&&(s=s.offset(-a.value,a.unit)),r&&(s=(0,i.toUTCTimeExtent)(s)),s.equals(n)?n:s)}},51939:(e,t,n)=>{n.d(t,{AL:()=>v,DV:()=>p,ER:()=>r,F_:()=>u,Nd:()=>d,Oo:()=>a,dy:()=>f,eS:()=>E,h4:()=>S,jC:()=>g,nq:()=>y,rZ:()=>m,y6:()=>h});var i=n(44135);const r="Raster.",a="Raster.Dim.",l=".Max",u={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},s=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function o(e,t){return new i.default({name:e,alias:t,domain:null,editable:!1,length:50,type:"string"})}function c(e,t){return new i.default({name:e,alias:t,domain:null,editable:!1,type:"double"})}function m(e){return o(u.servicePixelValue,e??"Service Pixel Value")}function f(e){return o(u.rawServicePixelValue,e??"Raw Service Pixel Value")}function d(){return o(u.itemPixelValue,"Item Pixel Value")}function y(e){return o(`${u.servicePixelValue}.${e}`,e)}function p(e){return c(`${u.magnitude}`,"Magnitude"+(e?` (${e})`:""))}function h(){return c(`${u.direction}`,"Direction (\xb0)")}function g(e){return e.fields.filter((e=>"oid"!==e.type&&"value"!==e.name.toLowerCase())).map((e=>{const t=e.clone();return t.name=`${r}${e.name}`,t}))}function v(e){const t=new Set,n=new Set,r=new Map;return e.variables.forEach((e=>{let{dimensions:i}=e;i.forEach((e=>{if(e.recurring)r.set(e.name,e.unit);else{const i="ISO8601"===e.unit?.trim()?t:n;i.add(e.name),e.hasRanges&&i.add(`${e.name}${l}`)}}))})),[o(u.variable,"Variable"),...[...t].map((e=>function(e,t){return new i.default({name:e,alias:t,domain:null,editable:!1,type:"date"})}(`${a}${e}`,x(e)))),...[...n].map((e=>c(`${a}${e}`,x(e)))),...[...r].map((e=>{let[t,n]=e;return c(`${a}${t}`,w(t,n))}))]}function w(e,t){return t=t?.toLowerCase(),t&&s.has(t)?s.get(t):x(e)}function x(e){const t=e.endsWith(l),n=t?e.slice(0,-4):e,i="StdTime"===n?"Standard Time":"StdZ"===n?"Standard Z":n;return t?`${i} Max`:i}function T(e,t){return t?new Date(e):e}function E(e,t,n){n?.length&&(t[u.variable]=n[0].variableName,n.forEach((n=>{let{dimensionName:i,values:r}=n;if(i&&r?.length){const n=`${a}${i}`,u=e.find((e=>{let{name:t}=e;return t===n}));if(!u)return;const s="date"===u.type,o=r[0];if(Array.isArray(o)){if(t[`${a}${i}`]=T(o[0],s),null!=o[1]){const n=`${a}${i}${l}`;if(e.some((e=>{let{name:t}=e;return t===n}))){const e=T(o[1],s);t[n]=e}}}else t[`${a}${i}`]=T(o,s)}})))}function S(e,t){if(t.pixelType.startsWith("f")&&e.forEach((e=>{let{format:t,fieldName:n}=e;t&&n&&/^raster\.(item|service)pixelvalue/i.test(n)&&(t.places=2)})),t.multidimensionalInfo){const n=t.multidimensionalInfo.variables.flatMap((e=>{let{dimensions:t}=e;return t}));e.forEach((e=>{let{format:t,fieldName:i}=e;if(t&&i?.startsWith(a)){const e=i.slice(a.length),r=`${e}${l}`,u=n.find((t=>{let{name:n}=t;return n===e||n===r}));u?.values?.every((e=>Number.isInteger(e)))&&(t.places=0)}}))}}},98156:(e,t,n)=>{n.r(t),n.d(t,{getTimeExtentFromLayers:()=>f,getTimeSliderSettingsFromWebDocument:()=>y,toLocalTimeExtent:()=>h,toUTCTimeExtent:()=>p});var i=n(18690),r=n(53084),a=n(18288),l=n(59187),u=n(42052),s=n(72027);function o(e){return void 0!==e.timeInfo}async function c(e,t){return e.widgets?.timeSlider?.fullTimeExtent??f(e.allLayers,t)}function m(e){const{numStops:t,stopInterval:n,stops:i}=e;return i?{dates:(0,r.clone)(i)}:n?{interval:n.clone()}:{count:t??5}}async function f(e,t){if(0===e.length)return l.default.allTime;await Promise.all(e.map((e=>e.load({signal:t}))));const n=e.filter(o),r=e.filter((e=>!o(e)&&null!=e.visibilityTimeExtent));if(0===n.length&&0===r.length)return l.default.allTime;const a=[],u=[];for(const i of n)"feature"!==i?.type&&"map-image"!==i?.type||!i.timeInfo?.hasLiveData?u.push(i):a.push(i);const s=e=>null==e||e.isAllTime,c=[...u.map((e=>{const t=e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:n}=e;return t?.intersection(n)??n})),...r.map((e=>e.visibilityTimeExtent))];if(c.some(s))return l.default.allTime;const m=a.map((async e=>{const n=(await e.fetchRecomputedExtents({signal:t}))?.timeExtent??e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:i}=e;return n?.intersection(i)??i})),f=(await Promise.allSettled(m)).map((e=>"fulfilled"===e.status?e.value:null));if(f.some(s))return l.default.allTime;const d=[...f,...c].filter(i.Ru);return 0===d.length?l.default.allTime:d.reduce(((e,t)=>e.union(t)))}function d(e,t){const n=e.currentTimeExtent;if(!n)return null;const{start:i,end:r}=n,a=i??r??null;switch(t){case"time-window":return new l.default({start:i,end:r});case"cumulative-from-start":return new l.default({start:null,end:a});case"cumulative-from-end":return new l.default({start:a,end:null});case"instant":return new l.default({start:a,end:a})}}async function y(e,t){if(!(0,u.r)(e)&&!function(e){return null!=e&&"object"==typeof e&&s.X in e}(e))return null;await e.load({signal:t});const n=e?.widgets?.timeSlider;if(!n)return null;const i=await c(e,t),r=n.loop,a=function(e){const t=e.numThumbs??2,n=e.currentTimeExtent;if(n){const{start:e,end:i}=n;return null!=e&&null!=i&&e.getTime()===i.getTime()?"instant":2===t?"time-window":null==e||0===e.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===t?"time-window":"cumulative-from-start"}(n);return{fullTimeExtent:i,loop:r,mode:a,playRate:n.stopDelay??2e3,stops:m(n),timeExtent:d(n,a)}}function p(e){if(!e)return e;const{start:t,end:n}=e;return new l.default({start:null!=t?(0,a.S1)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=n?(0,a.S1)(n,-n.getTimezoneOffset(),"minutes"):n})}function h(e){if(!e)return e;const{start:t,end:n}=e;return new l.default({start:null!=t?(0,a.S1)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=n?(0,a.S1)(n,n.getTimezoneOffset(),"minutes"):n})}}}]);
//# sourceMappingURL=28866.1d339433.chunk.js.map