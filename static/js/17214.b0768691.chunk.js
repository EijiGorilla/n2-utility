"use strict";(self.webpackChunkn2_utility=self.webpackChunkn2_utility||[]).push([[17214,98156],{17214:(t,e,n)=>{n.r(e),n.d(e,{default:()=>d});var i=n(35143),r=n(50076),l=n(50346),s=n(46053),a=(n(81806),n(76460),n(47249),n(85842)),u=n(19247),o=n(43543),m=n(59844),c=n(68295),f=n(2257);const d=t=>{let e=class extends t{constructor(){super(...arguments),this.view=null}get timeExtent(){return(0,o.F)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(t,e){const{layer:n}=this;if(!t)throw new r.default("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:n});const{popupEnabled:i}=n,s=(0,f.D8)(n,e);if(!i||null==s)return[];const a=await s.getRequiredFields();(0,l.throwIfAborted)(e);const o=new c.default;o.timeExtent=this.timeExtent,o.geometry=t,o.outFields=a,o.outSpatialReference=t.spatialReference;const{resolution:m,spatialReference:d}=this.view,p="2d"===this.view.type?new u.default(m,m,d):new u.default(.5*m,.5*m,d),{returnTopmostRaster:w,showNoDataRecords:y}=s.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},T={returnDomainValues:!0,returnTopmostRaster:w,pixelSize:p,showNoDataRecords:y,signal:e?.signal};return n.queryVisibleRasters(o,T).then((t=>t))}async getSourceScale(){return await(0,m.Hh)(),await this.layer.load(),(0,m.OO)(this.layer.serviceRasterInfo,this.view.spatialReference)}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return(0,i._)([(0,s.MZ)()],e.prototype,"layer",void 0),(0,i._)([(0,s.MZ)()],e.prototype,"suspended",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],e.prototype,"timeExtent",null),(0,i._)([(0,s.MZ)()],e.prototype,"view",void 0),e=(0,i._)([(0,a.$)("esri.views.layers.ImageryLayerView")],e),e}},43543:(t,e,n)=>{n.d(e,{F:()=>r});var i=n(98156);function r(t,e,n){if(null==t?.timeInfo)return null;const{datesInUnknownTimezone:r=!1,timeOffset:l,useViewTime:s}=t;let a=t.timeExtent;r&&(a=(0,i.toLocalTimeExtent)(a));let u=s?e&&a?e.intersection(a):e||a:a;return!u||u.isEmpty||u.isAllTime?u:(l&&(u=u.offset(-l.value,l.unit)),r&&(u=(0,i.toUTCTimeExtent)(u)),u.equals(n)?n:u)}},98156:(t,e,n)=>{n.r(e),n.d(e,{getTimeExtentFromLayers:()=>f,getTimeSliderSettingsFromWebDocument:()=>p,toLocalTimeExtent:()=>y,toUTCTimeExtent:()=>w});var i=n(18690),r=n(53084),l=n(18288),s=n(59187),a=n(42052),u=n(72027);function o(t){return void 0!==t.timeInfo}async function m(t,e){return t.widgets?.timeSlider?.fullTimeExtent??f(t.allLayers,e)}function c(t){const{numStops:e,stopInterval:n,stops:i}=t;return i?{dates:(0,r.clone)(i)}:n?{interval:n.clone()}:{count:e??5}}async function f(t,e){if(0===t.length)return s.default.allTime;await Promise.all(t.map((t=>t.load({signal:e}))));const n=t.filter(o),r=t.filter((t=>!o(t)&&null!=t.visibilityTimeExtent));if(0===n.length&&0===r.length)return s.default.allTime;const l=[],a=[];for(const i of n)"feature"!==i?.type&&"map-image"!==i?.type||!i.timeInfo?.hasLiveData?a.push(i):l.push(i);const u=t=>null==t||t.isAllTime,m=[...a.map((t=>{const e=t.timeInfo?.fullTimeExtent,{visibilityTimeExtent:n}=t;return e?.intersection(n)??n})),...r.map((t=>t.visibilityTimeExtent))];if(m.some(u))return s.default.allTime;const c=l.map((async t=>{const n=(await t.fetchRecomputedExtents({signal:e}))?.timeExtent??t.timeInfo?.fullTimeExtent,{visibilityTimeExtent:i}=t;return n?.intersection(i)??i})),f=(await Promise.allSettled(c)).map((t=>"fulfilled"===t.status?t.value:null));if(f.some(u))return s.default.allTime;const d=[...f,...m].filter(i.Ru);return 0===d.length?s.default.allTime:d.reduce(((t,e)=>t.union(e)))}function d(t,e){const n=t.currentTimeExtent;if(!n)return null;const{start:i,end:r}=n,l=i??r??null;switch(e){case"time-window":return new s.default({start:i,end:r});case"cumulative-from-start":return new s.default({start:null,end:l});case"cumulative-from-end":return new s.default({start:l,end:null});case"instant":return new s.default({start:l,end:l})}}async function p(t,e){if(!(0,a.r)(t)&&!function(t){return null!=t&&"object"==typeof t&&u.X in t}(t))return null;await t.load({signal:e});const n=t?.widgets?.timeSlider;if(!n)return null;const i=await m(t,e),r=n.loop,l=function(t){const e=t.numThumbs??2,n=t.currentTimeExtent;if(n){const{start:t,end:i}=n;return null!=t&&null!=i&&t.getTime()===i.getTime()?"instant":2===e?"time-window":null==t||0===t.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===e?"time-window":"cumulative-from-start"}(n);return{fullTimeExtent:i,loop:r,mode:l,playRate:n.stopDelay??2e3,stops:c(n),timeExtent:d(n,l)}}function w(t){if(!t)return t;const{start:e,end:n}=t;return new s.default({start:null!=e?(0,l.S1)(e,-e.getTimezoneOffset(),"minutes"):e,end:null!=n?(0,l.S1)(n,-n.getTimezoneOffset(),"minutes"):n})}function y(t){if(!t)return t;const{start:e,end:n}=t;return new s.default({start:null!=e?(0,l.S1)(e,e.getTimezoneOffset(),"minutes"):e,end:null!=n?(0,l.S1)(n,n.getTimezoneOffset(),"minutes"):n})}}}]);
//# sourceMappingURL=17214.b0768691.chunk.js.map