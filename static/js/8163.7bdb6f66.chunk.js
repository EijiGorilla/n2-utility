"use strict";(self.webpackChunkn2_utility=self.webpackChunkn2_utility||[]).push([[8163,54610,76420],{8163:(e,t,a)=>{a.r(t),a.d(t,{default:()=>N});var r=a(35143),s=a(86560),i=a(55171),n=a(3825),l=a(18690),o=a(50076),d=a(5632),u=a(42553),p=a(53084),c=a(49304),f=a(50346),y=a(46053),h=(a(81806),a(76460),a(28379)),m=a(85842),b=a(54039),g=a(13312),w=a(38911),v=a(54610),I=a(61979),F=a(91447),A=a(31933),R=a(43505),S=a(98662),E=a(72945),T=a(47437),M=a(54994),_=a(10290),O=a(90534);function $(e){return Array.isArray(e)?e.join(","):""}var k=a(98136),V=a(35298);function D(e,t){const a=t.id;return{id:a,name:t.name,url:`${e}/${a}`,type:t.type||"Table"}}function C(e){return{isDataVersioned:(0,k.Vf)(e,"hasVersionedData",!1),isDataBranchVersioned:(0,k.Vf)(e,"hasBranchVersionedData",!1)}}function U(e,t){const a=e?e.toLowerCase().split(",").map((e=>e.trim())):[],r=a.includes("query"),s=a.includes("editing")&&!t.datesInUnknownTimezone;let i=s&&a.includes("create"),n=s&&a.includes("delete"),l=s&&a.includes("update");return s&&!(i||n||l)&&(i=n=l=!0),{supportsAdd:i,supportsDelete:n,supportsEditing:s,supportsChangeTracking:a.includes("changetracking"),supportsQuery:r,supportsQueryDataElements:(0,k.Vf)(t,"supportsQueryDataElements",!1),supportsQueryDomains:(0,k.Vf)(t,"supportsQueryDomains",!1),supportsQueryContingentValues:(0,k.Vf)(t,"supportsQueryContingentValues",!1),supportsSync:a.includes("sync"),supportsUpdate:l}}function Z(e){return{maxRecordCountFactor:(0,k.kz)(e,"maxRecordCountFactor",void 0),maxRecordCount:(0,k.kz)(e,"maxRecordCount",void 0)}}function j(e){const t=e?.advancedEditingCapabilities;return{supportsAsyncApplyEdits:(0,k.Vf)(t,"supportsAsyncApplyEdits",!1),supportsGlobalId:(0,k.Vf)(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:(0,k.Vf)(t,"supportsReturnServiceEditsInSourceSR",!1),supportsSharedTemplates:(0,k.Vf)(e,"hasSharedTemplates",!1),supportsSplit:(0,k.Vf)(t,"supportsSplit",!1)}}function L(e){const t=e?.syncCapabilities,a=t?.supportedSyncDataOptions;return{supportsAsync:(0,k.Vf)(t,"supportsAsync",!1),supportedSyncDataOptions:{annotations:!(1&~a),dimensions:!(2&~a),contingentValues:!(4&~a),attributeRules:!(8&~a),utilityNetworkSystem:!(16&~a),annotationFullModel:!(32&~a),include3DObjects:!(64&~a),utilityNetworkMissingLayers:!(128&~a),preserveTrueCurves:!(256&~a)}}}let P=class extends(u.A.JSONSupportMixin(d.A.IdentifiableMixin(c.A))){constructor(e){super(e),this.url=null,this.sourceJSON=null,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1,this.userTypeExtensions=[],this.layerInfos=null,this.tableInfos=null,this.capabilities=null}read(e,t){this.sourceJSON=e,super.read(e,t)}get utilityNetworkUrl(){if(this.sourceJSON)for(const e of this.sourceJSON.layers)if("Utility Network Layer"===e.type)return`${this.url}/${e.id}`;return null}get versionManagementServiceUrl(){return this.sourceJSON?.hasBranchVersionedData&&!(0,T.$E)(this.url)?this.url.replace(/\/FeatureServer/i,"/VersionManagementServer"):null}readLayerInfos(e,t){return(t.layers||[]).map((e=>{const{type:t,geometryType:a}=e;return{...D(this.url,e),type:t||"Feature Layer",geometryType:a}}))}readTableInfos(e,t){return(t.tables||[]).map((e=>D(this.url,e)))}readCapabilities(e,t){return function(e){return{data:C(e),sync:L(e),operations:U(e.capabilities,e),query:Z(e),editing:j(e)}}(t)}get effectiveCapabilities(){const e=this.capabilities;if(!e)return null;const t=(0,p.clone)(e),{operations:a}=t;return this.userHasUpdateItemPrivileges?(a.supportsAdd=a.supportsDelete=a.supportsEditing=a.supportsQuery=a.supportsUpdate=!0,t):(this.userHasFullEditingPrivileges&&a.supportsEditing&&(a.supportsAdd=a.supportsDelete=a.supportsUpdate=!0),t)}load(e){return this.addResolvingPromise(this._fetchService(this.url,e).then((()=>this._setUserPrivileges(e)))),Promise.resolve(this)}async fetchAllLayersAndTables(e){return await this.load(e),this._fetchLayersAndTablesPromise||=this._fetchLayersAndTables(this.url),(0,f.throwIfAborted)(e),this._fetchLayersAndTablesPromise}async applyEdits(e,t){let a=null;try{const{results:r,edits:s,editedFeatures:i}=await this._internalApplyEdits(e,t),n=e=>e.filter((e=>!e.error)).map(p.clone);let l=0;return r.map((e=>{a=(0,I.Zk)(this.url,e.id,t?.gdbVersion,!0);const r={edits:s[l],addedFeatures:n(e.addFeatureResults),updatedFeatures:n(e.updateFeatureResults),deletedFeatures:n(e.deleteFeatureResults),addedAttachments:n(e.addAttachmentResults),updatedAttachments:n(e.updateAttachmentResults),deletedAttachments:n(e.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:e.editMoment?new Date(e.editMoment):null};l+=1,i.length>0&&(r.editedFeatures=i),a.resolve(r),a=null})),r}catch(r){throw a&&a.reject(r),r}}async querySharedTemplates(e){const t={...e?.query};return null==t.layers&&null==t.templateIds&&(t.layers=this.layerInfos.map((e=>e.id))),(await async function(e){let{serviceUrl:t,query:a,requestOptions:r={}}=e;if(null==a.layers&&null==a.templateIds)throw new o.default("query-shared-templates:invalid-parameters","Must supply a value for either the 'layers' or the 'templateIds' parameters");const s=(0,O.join)(t,"sharedTemplates","query"),i={f:"json",...r.query,...a};i.layers&&(i.layers=$(i.layers)),i.templateIds&&(i.templateIds=$(i.templateIds)),i.tags&&(i.tags=$(i.tags));const l={...r,responseType:"json",query:i};return(await(0,n.default)(s,l)).data.templates}({serviceUrl:this.url,query:t,requestOptions:e?.requestOptions})).map((e=>{const t=b.default.fromJSON(e);return t.featureService=this,t}))}async _setUserPrivileges(e){if(s.default.userPrivilegesApplied)try{const{features:{fullEdit:t},content:{updateItem:a}}=await this._fetchUserPrivileges(this.sourceJSON.serviceItemId,e);this._set("userHasFullEditingPrivileges",t),this._set("userHasUpdateItemPrivileges",a)}catch(t){(0,f.throwIfAbortError)(t)}}async _fetchUserPrivileges(e,t){const a=!0,r=!1,s=!1;if(!e)return{features:{edit:a,fullEdit:r},content:{updateItem:s}};let n,l,o;try{n=await(0,A.wI)(this.url,t)}catch(d){(0,f.throwIfAbortError)(d)}try{const e=null!=t?t.signal:null;l=await(i.id?.getCredential(`${n}/sharing`,{prompt:!1,signal:e}))}catch(d){(0,f.throwIfAbortError)(d)}if(!l)return{features:{edit:a,fullEdit:r},content:{updateItem:s}};try{if(o=new S.default({id:e,portal:{url:n}}),await o.load(t),o.portal.user)return(0,E.It)(o)}catch(d){(0,f.throwIfAbortError)(d)}return{features:{edit:a,fullEdit:r},content:{updateItem:s}}}async _internalApplyEdits(e,t){await(0,F.W1)(this.url);const a=t?.globalIdUsed??!1,r=g.default.fromJSON(this.sourceJSON.spatialReference),{edits:s,options:i}=await this._processApplyEditsParams(e,t),o=await Promise.all(s.map((async e=>{const t=e.addFeatures?.map((e=>(0,w.jR)({spatialReference:r},e,null)))??[],s=(await Promise.all(t)).filter(l.Ru),i=s.length>0?s:null,n=e.updateFeatures?.map((e=>(0,w.jR)({spatialReference:r},e,null)))??[],o=(await Promise.all(n)).filter(l.Ru),d=o.length>0?o:null,u=(0,w.TG)(e.identifierFields,e.deleteFeatures,a),p=u.length>0?u:null;(0,_.u)(i,d,r);const c=await(0,w.ZI)(e.identifierFields,e);let f=null;return c&&(f={adds:c.adds.length>0?c.adds:void 0,updates:c.updates.length>0?c.updates:void 0,deletes:c.deletes.length>0?c.deletes:void 0}),{id:e.id,adds:i,updates:d,deletes:p,attachments:f}}))),d={gdbVersion:i?.gdbVersion,rollbackOnFailure:!0,useGlobalIds:a,returnEditMoment:!0,honorSequenceOfEdits:i?.honorSequenceOfEdits,usePreviousEditMoment:i?.usePreviousEditMoment,returnServiceEditsInSourceSR:!1,returnServiceEditsOption:"originalAndCurrentFeatures",async:!1};await(0,V.ZJ)(this.url,t?.gdbVersion,!0);const u=(0,V.w5)(this.url,t?.gdbVersion||null);d.edits=JSON.stringify(o);const p=(0,M.Dl)(this.url),c=(0,M.jV)(p.query,{query:(0,M.lF)({...d,f:"json"}),method:"post"});let f;u&&(c.authMode="immediate",c.query.sessionId=V.TA);try{f=await(0,n.default)(this.url+"/applyEdits",c)}catch(y){if(!(0,w.F0)(y))throw y;c.authMode="immediate",f=await(0,n.default)(this.url+"/applyEdits",c)}return{...q(f),edits:s}}async _processApplyEditsParams(e,t){const a={...t,usingFeatureServiceEndpoint:!0};return{edits:await Promise.all(e.map((async e=>{const t=this.effectiveCapabilities,r=e&&(e.addFeatures||e.updateFeatures||e.deleteFeatures),s=e&&(e.addAttachments||e.updateAttachments||e.deleteAttachments);if((0,v.pz)(e,t,a,!!r,!!s,"feature-service"),!t.data.isDataVersioned&&a?.gdbVersion)throw new o.default("feature-service:invalid-parameter","'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isDataVersioned'");const i=(0,v.Tj)(e,t,"feature-service");return{...await(0,v.Gm)(i),id:e.id,identifierFields:e.identifierFields}}))),options:a}}async _fetchService(e,t){if(this.sourceJSON)return void this.read(this.sourceJSON,{url:(0,M.Dl)(e)});const a=await(0,n.default)(e,{responseType:"json",query:{f:"json"},...t});this.read(a.data,{url:(0,M.Dl)(e)})}async _fetchLayersAndTables(e){const t=`${e}/layers`,a=await(0,n.default)(t,{responseType:"json",query:{f:"json"}});return{layers:a.data.layers.map((e=>{const{type:t,geometryType:a}=e,r=D(this.url,e),s=(0,R.S)(e,r.url);return{...r,type:t||"Feature Layer",geometryType:a,capabilities:s}})),tables:a.data.tables.map((e=>{const t=D(this.url,e),a=(0,R.S)(e,t.url);return{...t,capabilities:a}}))}}};function q(e){const t=e.data,a=[];return{results:t.map((e=>{const t={addResults:e.addResults??[],updateResults:e.updateResults??[],deleteResults:e.deleteResults??[],attachments:e.attachments,editMoment:e.editMoment},r=(0,w.mP)(t),s=e.editedFeatures,i=s?.spatialReference?new g.default({wkid:s?.spatialReference.wkid,wkt:s?.spatialReference.wkt,latestWkid:s?.spatialReference.latestWkid,latestVcsWkid:s?.spatialReference.latestVcsWkid,vcsWkid:s?.spatialReference.vcsWkid}):null,n=s?(0,w.pX)(s,i):null;return n&&a.push({layerId:e.id,editedFeatures:n}),{id:e.id,editedFeatures:n,...r}})),editedFeatures:a}}(0,r._)([(0,y.MZ)()],P.prototype,"url",void 0),(0,r._)([(0,y.MZ)()],P.prototype,"sourceJSON",void 0),(0,r._)([(0,y.MZ)()],P.prototype,"userHasFullEditingPrivileges",void 0),(0,r._)([(0,y.MZ)()],P.prototype,"userHasUpdateItemPrivileges",void 0),(0,r._)([(0,y.MZ)({readOnly:!0})],P.prototype,"utilityNetworkUrl",null),(0,r._)([(0,y.MZ)({readOnly:!0})],P.prototype,"versionManagementServiceUrl",null),(0,r._)([(0,y.MZ)()],P.prototype,"userTypeExtensions",void 0),(0,r._)([(0,y.MZ)({json:{read:{source:["layers"]}}})],P.prototype,"layerInfos",void 0),(0,r._)([(0,h.w)("layerInfos",["layers"])],P.prototype,"readLayerInfos",null),(0,r._)([(0,y.MZ)({json:{read:{source:["tables"]}}})],P.prototype,"tableInfos",void 0),(0,r._)([(0,h.w)("tableInfos",["tables"])],P.prototype,"readTableInfos",null),(0,r._)([(0,y.MZ)({readOnly:!0,json:{read:{source:["hasVersionedData","hasSharedTemplates","hasBranchVersionedData","capabilities","supportsQueryDataElements","supportsQueryDomains","supportsQueryContingentValues","maxRecordCountFactor","maxRecordCount","advancedEditingCapabilities","supportsApplyEditsWithGlobalIds","syncCapabilities","datesInUnknownTimezone"]}}})],P.prototype,"capabilities",void 0),(0,r._)([(0,h.w)("capabilities",["hasVersionedData","hasSharedTemplates","hasBranchVersionedData","capabilities","supportsQueryDataElements","supportsQueryDomains","supportsQueryContingentValues","maxRecordCountFactor","maxRecordCount","advancedEditingCapabilities","supportsApplyEditsWithGlobalIds","syncCapabilities","datesInUnknownTimezone"])],P.prototype,"readCapabilities",null),(0,r._)([(0,y.MZ)({readOnly:!0})],P.prototype,"effectiveCapabilities",null),P=(0,r._)([(0,m.$)("esri.rest.featureService.FeatureService")],P);const N=P},12730:(e,t,a)=>{a.d(t,{T:()=>r});const r=new(a(45802).J)({"{acd53634-cbc7-44d5-bde9-692fa8d45850}":"autocomplete-freehand-polygons","{6f5fc612-d1ef-4d32-a2e1-18a1cb22331c}":"autocomplete-polygons","{09c6f589-a3ce-48ab-81bc-46965c58f264}":"circle","{bccf295a-9c64-4adc-903e-62d827c10ef7}":"create-points-along-line","{756cadf6-91e6-04b1-2938-e172a97af51c}":"create-structures","{ddbe4c0c-063f-8b60-b2da-b349a1e42e84}":"difference-polygon","{a5f4db5f-4a6b-29bd-1f32-9d81bf262c76}":"elevation-point-from-contour","{285ec4bb-60a8-7184-2088-5bee2149f2a4}":"elevation-point-from-dem","{28c04532-3daf-4d3d-b7be-a589c9c9a03e}":"ellipse","{0a7c16b9-1cfd-467f-8ece-6ba376192431}":"freehand","{af2dbf8f-280e-44db-8860-e399d0b30cf1}":"line","{bc485127-2ea2-4c8b-85ef-e8237959eb64}":"multipoint","{d304243a-5c3a-4ccc-b98b-93684b15fd83}":"parcel-seed","{2a8b3331-5238-4025-972e-452a69535b06}":"point","{d376f8e5-69e0-4273-9478-724e9e0d81ac}":"point-and-rotation","{93ce7077-f09e-455e-ade7-b7413cddc393}":"point-at-end-of-line","{8f79967b-66a0-4a1c-b884-f44bc7e26921}":"polygon","{a947ba80-1c29-4bcd-8672-1963b7b9dde0}":"radial-line","{6f0ed2cc-c099-4895-bd7e-beec2f78adbf}":"rectangle","{a281e635-0f22-47d4-a438-e4d29b920e22}":"regular-polygon","{5664cae4-c7de-432a-9933-9586bc15ed39}":"regular-polyline","{c5c42e29-44da-4a1c-8688-e02c07535bc3}":"right-angle-line","{ee16991b-6303-4a8a-9143-1914b2010c1a}":"right-angle-polygon","{7d3e17cf-30dd-4593-9bd8-0b2b8770f52a}":"split","{e00209dd-05c5-4424-be62-51581f9f811d}":"stream-line","{6c6970a7-5ca9-448c-9c7d-0d716cd2ac64}":"stream-polygon","{e22f7d98-007d-427c-8282-13704f7c84c3}":"trace","{6cf59352-8e14-402c-8f4c-ed72647f5e42}":"two-point-line"})},38911:(e,t,a)=>{a.d(t,{CU:()=>g,F0:()=>I,TG:()=>m,ZI:()=>y,jR:()=>f,mP:()=>b,pX:()=>v});var r=a(39356),s=a(50076),i=a(76460),n=a(31633),l=a(90534),o=a(9624),d=a(19902),u=a(32186),p=a(80963),c=a(54610);async function f(e,t,a){const{geometry:r}=t,s={...t.attributes};if(null!=a&&"mesh"===r?.type){const{transformFieldRoles:t}=a,{origin:i,spatialReference:l,vertexSpace:d}=r,c=r.transform??new u.default,f="local"===d.type,y=e.spatialReference,h=y.isGeographic,m=(0,p.aI)(y,l),b=(0,o.isEqualBaseGCS)(l,y)&&(0,o.canProjectWithoutEngine)(l,y);if(!(f&&h&&b||!f&&!h&&m))return null;const g=(0,o.projectWithoutEngine)(i,l,y);if(null==g)return null;if(s[t.originX]=g.x,s[t.originY]=g.y,s[t.originZ]=g.z??0,null!=c){const{translation:e,scale:a,rotation:r}=c,i=f?1:(0,n.KX)(l)/(0,n.KX)(y);s[t.translationX]=e[0]*i,s[t.translationY]=e[2]*i,s[t.translationZ]=-e[1]*i,s[t.scaleX]=a[0],s[t.scaleY]=a[2],s[t.scaleZ]=a[1],s[t.rotationX]=r[0],s[t.rotationY]=r[2],s[t.rotationZ]=-r[1],s[t.rotationDeg]=r[3]}return{attributes:s}}return null==r?{attributes:s}:"mesh"===r.type||"extent"===r.type?null:{geometry:r.toJSON(),attributes:s}}async function y(e,t){const a=await Promise.all((t.addAttachments??[]).map((t=>h(e,t)))),r=await Promise.all((t.updateAttachments??[]).map((t=>h(e,t)))),s=t.deleteAttachments??[];return a.length||r.length||s.length?{adds:a,updates:r,deletes:[...s]}:null}async function h(e,t){const{feature:a,attachment:r}=t,{globalId:s,name:i,contentType:n,data:o,uploadId:d}=r,u={globalId:s};if(a&&("attributes"in a?u.parentGlobalId=a.attributes?.[e.globalIdField]:a.globalId&&(u.parentGlobalId=a.globalId)),d)u.uploadId=d;else if(o){const e=await(0,l.parseData)(o);e&&(u.contentType=e.mediaType,u.data=e.data),o instanceof File&&(u.name=o.name)}return i&&(u.name=i),n&&(u.contentType=n),u}function m(e,t,a){if(!t||0===t.length)return[];if(a&&(0,c.zp)(t))return t.map((e=>e.globalId));if((0,c.r3)(t))return t.map((e=>e.objectId));const r=a?e.globalIdField:e.objectIdField;return r?t.map((e=>e.getAttribute(r))):[]}function b(e){const t=e?.assetMaps;if(t){for(const e of t.addResults)e.success||i.A.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${e.globalId}.`);for(const e of t.updateResults)e.success||i.A.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${e.globalId}.`)}const a=e?.attachments,r={addFeatureResults:e?.addResults?.map(g)??[],updateFeatureResults:e?.updateResults?.map(g)??[],deleteFeatureResults:e?.deleteResults?.map(g)??[],addAttachmentResults:a?.addResults?a.addResults.map(g):[],updateAttachmentResults:a?.updateResults?a.updateResults.map(g):[],deleteAttachmentResults:a?.deleteResults?a.deleteResults.map(g):[]};return e?.editMoment&&(r.editMoment=e.editMoment),r}function g(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new s.default("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}function w(e,t){return new r.default({attributes:e.attributes,geometry:(0,d.fromJSON)({...e.geometry,spatialReference:t})})}function v(e,t){return{adds:e?.adds?.map((e=>w(e,t)))||[],updates:e?.updates?.map((e=>({original:w(e[0],t),current:w(e[1],t)})))||[],deletes:e?.deletes?.map((e=>w(e,t)))||[],spatialReference:t}}function I(e){const t=e.details.raw,a=+t.code,r=+t.extendedCode;return 500===a&&(-2147217144===r||-2147467261===r)}},54039:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var r=a(35143),s=a(42553),i=a(46053),n=(a(81806),a(76460),a(47249),a(28379)),l=a(85842),o=a(12730);let d=class extends s.A{constructor(e){super(e),this.type="feature",this.templateId=null,this.defaultTool=null,this.description=null,this.globalId="",this.hash="",this.layerIds=[],this.name="",this.subtypeCode=null,this.status=null,this.userIdentity=null,this.tags=[],this.visible=!0}readThumbnail(e){return null==e||""===e?null:{contentType:"png",imageData:e,height:64,width:64}}readDefaultTool(e){return null==e?null:o.T.fromJSON(e.toLowerCase())}readLayerIds(e,t){return null!=t.layerIds?t.layerIds.split(",").map((e=>parseInt(e.trim(),10))):null!=t.layerId?[t.layerId]:[]}readTags(e,t){const a=t.tag;return null==a?[]:a.split(";").map((e=>e.trim()))}};(0,r._)([(0,i.MZ)()],d.prototype,"type",void 0),(0,r._)([(0,i.MZ)({json:{read:!1,write:!1}})],d.prototype,"featureService",void 0),(0,r._)([(0,i.MZ)()],d.prototype,"thumbnail",void 0),(0,r._)([(0,n.w)("thumbnail")],d.prototype,"readThumbnail",null),(0,r._)([(0,i.MZ)()],d.prototype,"templateId",void 0),(0,r._)([(0,i.MZ)()],d.prototype,"defaultTool",void 0),(0,r._)([(0,n.w)("defaultTool")],d.prototype,"readDefaultTool",null),(0,r._)([(0,i.MZ)()],d.prototype,"description",void 0),(0,r._)([(0,i.MZ)()],d.prototype,"globalId",void 0),(0,r._)([(0,i.MZ)()],d.prototype,"hash",void 0),(0,r._)([(0,i.MZ)()],d.prototype,"layerIds",void 0),(0,r._)([(0,n.w)("layerIds",["layerIds","layerId"])],d.prototype,"readLayerIds",null),(0,r._)([(0,i.MZ)()],d.prototype,"name",void 0),(0,r._)([(0,i.MZ)({json:{name:"subtype"}})],d.prototype,"subtypeCode",void 0),(0,r._)([(0,i.MZ)()],d.prototype,"status",void 0),(0,r._)([(0,i.MZ)()],d.prototype,"userIdentity",void 0),(0,r._)([(0,i.MZ)()],d.prototype,"tags",void 0),(0,r._)([(0,n.w)("tags",["tag"])],d.prototype,"readTags",null),(0,r._)([(0,i.MZ)()],d.prototype,"visible",void 0),d=(0,r._)([(0,l.$)("esri.editing.sharedTemplates.SharedTemplateMetadata")],d);const u=d},54610:(e,t,a)=>{a.d(t,{Gm:()=>E,Tj:()=>T,applyEdits:()=>F,pz:()=>M,r3:()=>w,uploadAssets:()=>$,zp:()=>I});var r=a(39356),s=a(19276),i=a(50076),n=a(53084),l=a(76460),o=a(50346),d=a(90534),u=a(49723),p=a(73953),c=a(80963),f=a(61979),y=a(53430),h=a(19463),m=a(31933);function b(e){return null!=e?.applyEdits}function g(e){return"object"==typeof e&&null!=e&&"objectId"in e&&!!e.objectId}function w(e){return e.every(g)}function v(e){return"object"==typeof e&&null!=e&&"globalId"in e&&!!e.globalId}function I(e){return e.every(v)}async function F(e,t,a){let r,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const d="gdbVersion"in e?e.gdbVersion:null,p=s.gdbVersion??d;if((0,f.Mk)(e)&&e.url)r=(0,f.Zk)(e.url,e.layerId,p,"original-and-current-features"===s.returnServiceEditsOption);else{r=(0,o.createResolver)(),r.promise.then((t=>{(t.addedFeatures.length||t.updatedFeatures.length||t.deletedFeatures.length||t.addedAttachments.length||t.updatedAttachments.length||t.deletedAttachments.length)&&e.emit("edits",t)}));const t={result:r.promise};e.emit("apply-edits",t)}try{const{results:o,edits:d}=await async function(e,t,a,r){if(await e.load(),!b(t))throw new i.default(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!(0,m.tk)(e))throw new i.default(`${e.type}-layer:editing-disabled`,"Editing is disabled for layer",{layer:e});const{edits:s,options:n}=await async function(e,t,a){const r=(0,m.BR)(e),s=t&&(t.addFeatures||t.updateFeatures||t.deleteFeatures),n=t&&(t.addAttachments||t.updateAttachments||t.deleteAttachments),o=null!=e.infoFor3D;if(M(t,r,a,!!s,!!n,`${e.type}-layer`),!r.data.isVersioned&&a?.gdbVersion)throw new i.default(`${e.type}-layer:invalid-parameter`,"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!r.editing.supportsRollbackOnFailure&&a?.rollbackOnFailureEnabled)throw new i.default(`${e.type}-layer:invalid-parameter`,"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");const d={...a};if(null!=d.rollbackOnFailureEnabled||r.editing.supportsRollbackOnFailure||(d.rollbackOnFailureEnabled=!0),d.rollbackOnFailureEnabled||"original-and-current-features"!==d.returnServiceEditsOption||(!1===d.rollbackOnFailureEnabled&&l.A.getLogger("esri.layers.graphics.editingSupport").warn(`${e.type}-layer:invalid-parameter`,"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true, but 'rollBackOnFailure' was set to false. 'rollBackOnFailure' has been overwritten and set to true."),d.rollbackOnFailureEnabled=!0),!r.editing.supportsReturnServiceEditsInSourceSpatialReference&&d.returnServiceEditsInSourceSR)throw new i.default(`${e.type}-layer:invalid-parameter`,"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(d.returnServiceEditsInSourceSR&&"original-and-current-features"!==d.returnServiceEditsOption)throw new i.default(`${e.type}-layer:invalid-parameter`,"'returnServiceEditsInSourceSR' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const p=T(t,r,`${e.type}-layer`),c=a?.globalIdUsed||o,f=e.fields.filter((e=>"big-integer"===e.type||"oid"===e.type&&(e.length||0)>=8));if(c){const{globalIdField:t}=e;if(null==t)throw new i.default(`${e.type}-layer:invalid-parameter`,"Layer does not specify a global id field.");p.addFeatures.forEach((e=>function(e,t){const{attributes:a}=e;null==a[t]&&(a[t]=(0,u.yS)())}(e,t)))}return p.addFeatures.forEach((t=>function(e,t,a,r){A(e,t,a,r),R(e,t)}(t,e,c,f))),p.updateFeatures.forEach((t=>function(e,t,a,r){A(e,t,a,r),R(e,t);const s=(0,m.BR)(t);if("geometry"in e&&null!=e.geometry&&!s?.editing.supportsGeometryUpdate)throw new i.default(`${t.type}-layer:unsupported-operation`,"Layer does not support geometry updates.")}(t,e,c,f))),p.deleteFeatures.forEach((t=>function(e,t,a,r){A(e,t,a,r)}(t,e,c,f))),p.addAttachments.forEach((t=>S(t,e))),p.updateAttachments.forEach((t=>S(t,e))),o&&await async function(e,t){const{infoFor3D:a}=t;if(null==a)return;if(!(0,h.JQ)(a))throw new i.default(`${t.type}-layer:binary-gltf-asset-not-supported`,"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");e.addAssetFeatures??=[];const{addAssetFeatures:r}=e;for(const s of e.addFeatures??[])O(s)&&r.push(s);for(const s of e.updateFeatures??[])O(s)&&r.push(s)}(p,e),{edits:await E(p),options:d}}(e,a,r);return s.addFeatures?.length||s.updateFeatures?.length||s.deleteFeatures?.length||s.addAttachments?.length||s.updateAttachments?.length||s.deleteAttachments?.length?{edits:s,results:await t.applyEdits(s,n)}:{edits:s,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}(e,t,a,s),p=e=>e.filter((e=>!e.error)).map(n.clone),c={edits:d,addedFeatures:p(o.addFeatureResults),updatedFeatures:p(o.updateFeatureResults),deletedFeatures:p(o.deleteFeatureResults),addedAttachments:p(o.addAttachmentResults),updatedAttachments:p(o.updateAttachmentResults),deletedAttachments:p(o.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:o.editMoment?new Date(o.editMoment):null,globalIdToObjectId:s.globalIdToObjectId};return o.editedFeatureResults?.length&&(c.editedFeatures=o.editedFeatureResults),r.resolve(c),o}catch(c){throw r.reject(c),c}}function A(e,t,a,r){if(a){if("attributes"in e&&!e.attributes[t.globalIdField])throw new i.default(`${t.type}-layer:invalid-parameter`,`Feature should have '${t.globalIdField}' when 'globalIdUsed' is true`);if(!("attributes"in e)&&!e.globalId)throw new i.default(`${t.type}-layer:invalid-parameter`,"`'globalId' of the feature should be passed when 'globalIdUsed' is true")}if(r.length&&"attributes"in e)for(const s of r){const a=e.attributes[s.name];if(void 0!==a&&!(0,y.isValidFieldValue)(s,a))throw new i.default(`${t.type}-layer:invalid-parameter`,`Big-integer field '${s.name}' of the feature must be less than ${Number.MAX_SAFE_INTEGER}`,{feature:e})}if("geometry"in e&&null!=e.geometry){if(e.geometry.hasZ&&!1===t.capabilities?.data.supportsZ)throw new i.default(`${t.type}-layer:z-unsupported`,"Layer does not support z values while feature has z values.");if(e.geometry.hasM&&!1===t.capabilities?.data.supportsM)throw new i.default(`${t.type}-layer:m-unsupported`,"Layer does not support m values while feature has m values.")}}function R(e,t){if("geometry"in e&&"mesh"===e.geometry?.type&&null!=t.infoFor3D&&null!=t.spatialReference){const{geometry:a}=e,{spatialReference:r,vertexSpace:s}=a,n=t.spatialReference,l="local"===s.type,o=(0,c.EA)(n),d=(0,c.aI)(n,r),u=d||(0,c.oT)(n)&&((0,c.oT)(r)||(0,c.K8)(r));if(!(l&&o&&u||!l&&!o&&d))throw new i.default(`${t.type}-layer:mesh-unsupported`,`Uploading a mesh with a ${s.type} vertex space and a spatial reference wkid:${r.wkid} to a layer with a spatial reference wkid:${n.wkid} is not supported.`)}}function S(e,t){const{feature:a,attachment:r}=e;if(!a||"attributes"in a&&!a.attributes[t.globalIdField])throw new i.default(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in a)&&!a.globalId)throw new i.default(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to 'globalId' of the parent feature");if(!r.globalId)throw new i.default(`${t.type}-layer:invalid-parameter`,"Attachment should have 'globalId'");if(!r.data&&!r.uploadId)throw new i.default(`${t.type}-layer:invalid-parameter`,"Attachment should have 'data' or 'uploadId'");if(!(r.data instanceof File&&r.data.name)&&!r.name)throw new i.default(`${t.type}-layer:invalid-parameter`,"'name' is required when attachment is specified as Base64 encoded string using 'data'");if(!t.capabilities?.editing.supportsUploadWithItemId&&r.uploadId)throw new i.default(`${t.type}-layer:invalid-parameter`,"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof r.data){const e=(0,d.dataComponents)(r.data);if(e&&!e.isBase64)throw new i.default(`${t.type}-layer:invalid-parameter`,"Attachment 'data' should be a Blob, File or Base64 encoded string")}}async function E(e){const t=e.addFeatures??[],a=e.updateFeatures??[],r=t.concat(a).map((e=>e.geometry)),s=await(0,p.normalizeCentralMeridian)(r),i=t.length,n=a.length;return s.slice(0,i).forEach(((e,a)=>t[a].geometry=e)),s.slice(i,i+n).forEach(((e,t)=>a[t].geometry=e)),e}function T(e,t,a){const r=function(e){return{addFeatures:Array.from(e?.addFeatures??[]),updateFeatures:Array.from(e?.updateFeatures??[]),deleteFeatures:e&&s.default.isCollection(e.deleteFeatures)?e.deleteFeatures.toArray():e.deleteFeatures||[],addAttachments:e.addAttachments||[],updateAttachments:e.updateAttachments||[],deleteAttachments:e.deleteAttachments||[]}}(e);if(r.addFeatures?.length&&!t.operations.supportsAdd)throw new i.default(`${a}:unsupported-operation`,"Layer does not support adding features.");if(r.updateFeatures?.length&&!t.operations.supportsUpdate)throw new i.default(`${a}:unsupported-operation`,"Layer does not support updating features.");if(r.deleteFeatures?.length&&!t.operations.supportsDelete)throw new i.default(`${a}:unsupported-operation`,"Layer does not support deleting features.");return r.addFeatures=r.addFeatures.map(_),r.updateFeatures=r.updateFeatures.map(_),r.addAssetFeatures=[],r}function M(e,t,a,r,s,n){if(!e||!r&&!s)throw new i.default(`${n}:missing-parameters`,"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!t.editing.supportsGlobalId&&a?.globalIdUsed&&!a.usingFeatureServiceEndpoint)throw new i.default(`${n}:invalid-parameter`,"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!t.editing.supportsGlobalId&&s)throw new i.default(`${n}:invalid-parameter`,"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if(!a?.globalIdUsed&&s)throw new i.default(`${n}:invalid-parameter`,"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true")}function _(e){const t=new r.default;return e.attributes||(e.attributes={}),t.geometry=e.geometry,t.attributes=e.attributes,t}function O(e){return"mesh"===e?.geometry?.type}function $(e,t,a,r){if(!b(t))throw new i.default(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!t.uploadAssets)throw new i.default(`${e.type}-layer:no-asset-upload-support`,"Layer source does not support uploadAssets capability",{layer:e});return t.uploadAssets(a,r)}}}]);
//# sourceMappingURL=8163.7bdb6f66.chunk.js.map